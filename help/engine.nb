(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    249583,       6068]
NotebookOptionsPosition[    245761,       5940]
NotebookOutlinePosition[    246508,       5964]
CellTagsIndexPosition[    246465,       5961]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"$HistoryLength", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"On", "[", "Assert", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$AssertFunction", " ", "=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"{", "##", "}"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}], ")"}], "&"}]}], " ", ";"}]}], "Input",
 CellChangeTimes->{{3.6095075546391788`*^9, 3.6095075602395887`*^9}, {
  3.6095077375339003`*^9, 3.609507763804346*^9}, {3.609509804182206*^9, 
  3.6095098045102243`*^9}, {3.6095249828353753`*^9, 3.6095249834034076`*^9}}],

Cell[CellGroupData[{

Cell["functions", "Title",
 CellChangeTimes->{{3.609520740753742*^9, 3.6095207428968644`*^9}}],

Cell[CellGroupData[{

Cell["basic bitboard functions", "Section",
 CellChangeTimes->{{3.609523335199136*^9, 3.6095233416645055`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Remove", "[", 
   RowBox[{
   "MatrixToBitBoard", ",", "BitBoardToMatrix", ",", "SquareToXY", ",", 
    "XYToSquare", ",", "BitBoardToMatrixForm", ",", "GoDirection"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MatrixToBitBoard", "[", "board_List", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{
       RowBox[{"Dimensions", "[", "board", "]"}], "===", 
       RowBox[{"{", 
        RowBox[{"8", ",", "8"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"FromDigits", "[", 
      RowBox[{
       RowBox[{"Reverse", "[", 
        RowBox[{"Flatten", "[", "board", "]"}], "]"}], ",", "2"}], "]"}]}], 
    ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BitBoardToMatrix", "[", "board_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"board", "<", 
       RowBox[{"2", "^", "64"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Partition", "[", 
      RowBox[{
       RowBox[{"Reverse", "[", 
        RowBox[{"IntegerDigits", "[", 
         RowBox[{"board", ",", "2", ",", "64"}], "]"}], "]"}], ",", "8"}], 
      "]"}]}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BitBoardToMatrixForm", "[", "board_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"board", "<", 
       RowBox[{"2", "^", "64"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Reverse", "[", 
         RowBox[{"IntegerDigits", "[", 
          RowBox[{"board", ",", "2", ",", "64"}], "]"}], "]"}], ",", "8"}], 
       "]"}], "]"}]}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SquareToXY", "[", "sq_Integer", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"BitAnd", "[", 
        RowBox[{"sq", ",", "7"}], "]"}], ",", 
       RowBox[{"BitShiftRight", "[", 
        RowBox[{"sq", ",", "3"}], "]"}]}], "}"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"XYToSquare", "[", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_"}], "}"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"0", "\[LessEqual]", "x", "<", "8"}], "&&", 
      RowBox[{"0", "\[LessEqual]", "y", "<", "8"}]}], ",", 
     RowBox[{
      RowBox[{"8", "*", "y"}], "+", "x"}], ",", "64"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GoDirection", "[", 
     RowBox[{"sq_", ",", "dir_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Assert", "[", 
       RowBox[{"sq", "<", "64"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"XYToSquare", "[", 
       RowBox[{
        RowBox[{"SquareToXY", "[", "sq", "]"}], "+", "dir"}], "]"}]}], 
     "\[IndentingNewLine]", ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Remove", "[", 
   RowBox[{
   "PDEP", ",", "PEXT", ",", "POPCNT", ",", "NOT", ",", "BSF", ",", "BLSR"}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PDEP", "[", 
    RowBox[{"x_", ",", "m_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"y", "=", "0"}], ",", 
       RowBox[{"b", "=", "1"}], ",", 
       RowBox[{"mask", "=", "m"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"mask", "=!=", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{"b", ",", "x"}], "]"}], "=!=", "0"}], ",", 
           RowBox[{"y", "=", 
            RowBox[{"BitOr", "[", 
             RowBox[{"y", ",", 
              RowBox[{"BitAnd", "[", 
               RowBox[{"mask", ",", 
                RowBox[{"-", "mask"}]}], "]"}]}], "]"}]}]}], "]"}], ";", 
         RowBox[{"mask", "=", 
          RowBox[{"BitAnd", "[", 
           RowBox[{"mask", ",", 
            RowBox[{"mask", "-", "1"}]}], "]"}]}], ";", 
         RowBox[{"b", "=", 
          RowBox[{"b", "+", "b"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "y"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PEXT", "[", 
    RowBox[{"x_", ",", "m_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"y", "=", "0"}], ",", 
       RowBox[{"b", "=", "1"}], ",", 
       RowBox[{"mask", "=", "m"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"mask", "=!=", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{
              RowBox[{"BitAnd", "[", 
               RowBox[{"mask", ",", 
                RowBox[{"-", "mask"}]}], "]"}], ",", "x"}], "]"}], "=!=", 
            "0"}], ",", 
           RowBox[{"y", "=", 
            RowBox[{"BitOr", "[", 
             RowBox[{"y", ",", "b"}], "]"}]}]}], "]"}], ";", 
         RowBox[{"mask", "=", 
          RowBox[{"BitAnd", "[", 
           RowBox[{"mask", ",", 
            RowBox[{"mask", "-", "1"}]}], "]"}]}], ";", 
         RowBox[{"b", "=", 
          RowBox[{"b", "+", "b"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "y"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"POPCNT", "[", "m_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"y", "=", "0"}], ",", 
       RowBox[{"mask", "=", "m"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"mask", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"y", "=", 
          RowBox[{"y", "+", "1"}]}], ";", 
         RowBox[{"mask", "=", 
          RowBox[{"BitAnd", "[", 
           RowBox[{"mask", ",", 
            RowBox[{"mask", "-", "1"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "y"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NOT", "[", "x_", "]"}], ":=", 
   RowBox[{"BitAnd", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"2", "^", "64"}], "-", "1"}], ",", 
     RowBox[{"BitNot", "[", "x", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BSF", "[", "x_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"x", "=!=", "0"}], "]"}], ";", 
     RowBox[{"IntegerExponent", "[", 
      RowBox[{"x", ",", "2"}], "]"}]}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLSR", "[", "x_", "]"}], ":=", 
   RowBox[{"BitAnd", "[", 
    RowBox[{"x", ",", 
     RowBox[{"x", "-", "1"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ANDN", "[", 
     RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
    RowBox[{"BitAnd", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"2", "^", "64"}], "-", "1"}], ",", 
      RowBox[{"BitNot", "[", "x", "]"}], ",", "y"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Remove", "[", 
   RowBox[{"DisjointQ", ",", "PartitionQ"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DisjointQ", "[", "list_List", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"POPCNT", "[", 
      RowBox[{"BitOr", "@@", "list"}], "]"}], "===", 
     RowBox[{"Total", "[", 
      RowBox[{"POPCNT", "/@", "list"}], "]"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PartitionQ", "[", 
    RowBox[{"x_", ",", "list_List"}], "]"}], ":=", 
   RowBox[{"And", "[", 
    RowBox[{
     RowBox[{"x", "===", 
      RowBox[{"BitOr", "@@", "list"}]}], ",", 
     RowBox[{
      RowBox[{"POPCNT", "[", "x", "]"}], "===", 
      RowBox[{"Total", "[", 
       RowBox[{"POPCNT", "/@", "list"}], "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.579094467086935*^9, 3.5790944887241726`*^9}, {
   3.609507362166041*^9, 3.6095074137085314`*^9}, {3.609507449806995*^9, 
   3.6095074833626537`*^9}, {3.609507565169197*^9, 3.6095076516713495`*^9}, {
   3.6095077700443573`*^9, 3.6095077920247955`*^9}, {3.6095078941581755`*^9, 
   3.609507976167519*^9}, {3.609508007851175*^9, 3.6095080651968756`*^9}, {
   3.6095082370265694`*^9, 3.609508284987313*^9}, {3.609509311887048*^9, 
   3.6095093646240644`*^9}, {3.6095093958208485`*^9, 
   3.6095094779605465`*^9}, {3.6095095337707396`*^9, 3.609509598055416*^9}, {
   3.609509631315318*^9, 3.6095096782980056`*^9}, {3.609509722156514*^9, 
   3.6095097267647777`*^9}, {3.6095097631408587`*^9, 
   3.6095097998359575`*^9}, {3.609509830573715*^9, 3.609510089290513*^9}, {
   3.6095101468378043`*^9, 3.609510338854787*^9}, {3.6095104067916727`*^9, 
   3.6095104072827015`*^9}, {3.609510445806905*^9, 3.6095104462549305`*^9}, {
   3.609510487773305*^9, 3.6095105097685633`*^9}, {3.6095105751453023`*^9, 
   3.6095105838698015`*^9}, {3.6095112428064904`*^9, 3.609511342783209*^9}, {
   3.609511400270497*^9, 3.60951144421001*^9}, {3.6095115007452435`*^9, 
   3.6095115334251127`*^9}, {3.6095116666657333`*^9, 3.609511732985527*^9}, 
   3.609512221385462*^9, {3.609512277190654*^9, 3.6095123907131467`*^9}, {
   3.609512502038514*^9, 3.6095125079078503`*^9}, {3.6095126016952143`*^9, 
   3.6095126376292696`*^9}, {3.60951268973925*^9, 3.609512738633047*^9}, {
   3.609513000685035*^9, 3.609513012915735*^9}, {3.6095131102223005`*^9, 
   3.6095131756500425`*^9}, {3.6095157048607054`*^9, 3.609515836881256*^9}, {
   3.609515915145733*^9, 3.6095159409312077`*^9}, {3.60951637246489*^9, 
   3.609516416031382*^9}, {3.6095164509903812`*^9, 3.60951652334052*^9}, {
   3.6095165811558266`*^9, 3.6095165894643016`*^9}, {3.6095166673367558`*^9, 
   3.60951667405914*^9}, {3.609516785182496*^9, 3.6095168550194907`*^9}, {
   3.6095169505069523`*^9, 3.609516951215993*^9}, {3.6095169963755755`*^9, 
   3.6095170632103987`*^9}, {3.6095171299982185`*^9, 3.609517135652542*^9}, {
   3.60951763180192*^9, 3.609517632789976*^9}, {3.6095176735753093`*^9, 
   3.6095180697529697`*^9}, {3.609518113509472*^9, 3.6095181658334646`*^9}, {
   3.609518497187417*^9, 3.609518531962406*^9}, {3.6095190567374215`*^9, 
   3.6095190652019057`*^9}, {3.6095190955926437`*^9, 
   3.6095191108245153`*^9}, {3.6095206198488264`*^9, 
   3.6095206415750694`*^9}, {3.609521008067031*^9, 3.6095210532366147`*^9}, {
   3.6095223875639343`*^9, 3.609522407727087*^9}, {3.6095233315779285`*^9, 
   3.609523333652047*^9}, {3.609527673758287*^9, 3.609527706644168*^9}, {
   3.6095284727609873`*^9, 3.609528477610265*^9}, {3.609534137047966*^9, 
   3.6095341650855694`*^9}, {3.6095348479866295`*^9, 3.609534891393112*^9}, {
   3.609596017897715*^9, 3.609596031216477*^9}, {3.6096853929840884`*^9, 
   3.609685394504175*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["attack and move functions", "Section",
 CellChangeTimes->{{3.6095233556513057`*^9, 3.6095233647938285`*^9}, {
  3.6095916000640297`*^9, 3.6095916012620983`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BitsN", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BitsS", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", 
        "1"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BitsW", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BitsE", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BitsCorners", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "1"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BitsRank2", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BitsRank7", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", 
        "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WhiteOOMask", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", ",", 
        "0"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WhiteOOOMask", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "1", ",", "1", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlackOOMask", "=", 
   RowBox[{"MatrixToBitBoard", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
        "0"}], "}"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlackOOOMask", "=", 
    RowBox[{"MatrixToBitBoard", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0", ",", "0", ",", "1", ",", "1", ",", "0", ",", "0", ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
         "0"}], "}"}]}], "}"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CastlingRights", "=", 
    RowBox[{"Flatten", "[", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {"7", "15", "15", "15", "3", "15", "15", "11"},
        {"15", "15", "15", "15", "15", "15", "15", "15"},
        {"15", "15", "15", "15", "15", "15", "15", "15"},
        {"15", "15", "15", "15", "15", "15", "15", "15"},
        {"15", "15", "15", "15", "15", "15", "15", "15"},
        {"15", "15", "15", "15", "15", "15", "15", "15"},
        {"15", "15", "15", "15", "15", "15", "15", "15"},
        {"13", "15", "15", "15", "12", "15", "15", "15"}
       }], "\[NoBreak]", ")"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareH8", "=", 
   RowBox[{"2", "^", "7"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareG8", "=", 
   RowBox[{"2", "^", "6"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareF8", "=", 
   RowBox[{"2", "^", "5"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareE8", "=", 
   RowBox[{"2", "^", "4"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareD8", "=", 
   RowBox[{"2", "^", "3"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareC8", "=", 
   RowBox[{"2", "^", "2"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareB8", "=", 
   RowBox[{"2", "^", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SquareA8", "=", 
    RowBox[{"2", "^", "0"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareH1", "=", 
   RowBox[{"2", "^", "63"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareG1", "=", 
   RowBox[{"2", "^", "64"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareF1", "=", 
   RowBox[{"2", "^", "61"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareE1", "=", 
   RowBox[{"2", "^", "60"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareD1", "=", 
   RowBox[{"2", "^", "59"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareC1", "=", 
   RowBox[{"2", "^", "58"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareB1", "=", 
   RowBox[{"2", "^", "57"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SquareA1", "=", 
   RowBox[{"2", "^", "56"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{
  3.609518502007693*^9, {3.609518555266739*^9, 3.6095187180020475`*^9}, {
   3.6095187567012606`*^9, 3.609518772145144*^9}, {3.609518806240094*^9, 
   3.6095188188598156`*^9}, {3.609518906757843*^9, 3.6095189289831142`*^9}, {
   3.6095189807200737`*^9, 3.6095190292958517`*^9}, {3.609519083952978*^9, 
   3.6095190900073247`*^9}, {3.60951912157113*^9, 3.609519122678193*^9}, {
   3.609519162692482*^9, 3.609519180644509*^9}, {3.6095192357356596`*^9, 
   3.609519235811664*^9}, {3.6095192884916773`*^9, 3.6095193355663695`*^9}, {
   3.609519409847618*^9, 3.609519508281248*^9}, {3.6095195810014076`*^9, 
   3.609519630810257*^9}, {3.6095196673263454`*^9, 3.6095197210584183`*^9}, {
   3.609520033582294*^9, 3.609520142717536*^9}, {3.609520185483982*^9, 
   3.6095202321596518`*^9}, {3.609520265243544*^9, 3.6095203678464127`*^9}, {
   3.609520684855545*^9, 3.609520716439351*^9}, {3.6095207608068886`*^9, 
   3.609520771523502*^9}, {3.6095208626517143`*^9, 3.609520960398305*^9}, {
   3.6095211668631144`*^9, 3.6095211674641485`*^9}, {3.6095215654059095`*^9, 
   3.6095217012616796`*^9}, {3.6095217323274565`*^9, 3.609521762891205*^9}, {
   3.609521905419357*^9, 3.6095219213392677`*^9}, {3.609521965245779*^9, 
   3.6095221013965664`*^9}, {3.6095221341324387`*^9, 3.609522179126012*^9}, {
   3.60952222070339*^9, 3.6095222781646767`*^9}, {3.6095224348936415`*^9, 
   3.609522463033251*^9}, {3.6095225629969683`*^9, 3.6095225645910597`*^9}, {
   3.609522826533042*^9, 3.6095228315123262`*^9}, {3.6095231971082373`*^9, 
   3.6095232048776817`*^9}, {3.60952334750984*^9, 3.6095233495389557`*^9}, {
   3.6095243819030037`*^9, 3.609524382599044*^9}, {3.6095247999989176`*^9, 
   3.6095248360839815`*^9}, {3.6095248892010193`*^9, 3.609524971316716*^9}, {
   3.6095951318250346`*^9, 3.6095951593046064`*^9}, {3.6096170895459013`*^9, 
   3.609617121108707*^9}, {3.609620704613672*^9, 3.6096207633560314`*^9}, {
   3.609620843443612*^9, 3.6096208612426305`*^9}, {3.609627353844907*^9, 
   3.609627374646096*^9}, {3.609627426550065*^9, 3.6096274773329697`*^9}, {
   3.609627517393261*^9, 3.6096275761126194`*^9}, {3.609630167733852*^9, 
   3.609630210656307*^9}, {3.6096303304601593`*^9, 3.6096303428038654`*^9}, 
   3.609631005807787*^9, {3.6097188407944765`*^9, 3.6097188647278457`*^9}, {
   3.609718995910349*^9, 3.609719005675907*^9}, {3.6097191643059807`*^9, 
   3.6097191821660023`*^9}}],

Cell[CellGroupData[{

Cell["rook attacks", "Subsection",
 CellChangeTimes->{{3.6095240812728086`*^9, 3.6095240861200857`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Remove", "[", 
   RowBox[{
   "RookMaskEXT", ",", "RookMaskDEP", ",", "RookMaskLOOKUP", ",", 
    "RookAttacks"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RookMaskDEP", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"RookMaskDEP", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"xx", ",", "yy"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"xx", ",", "yy"}], "}"}], "=", 
          RowBox[{"SquareToXY", "[", "sq", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Xor", "[", 
              RowBox[{
               RowBox[{"x", "===", "xx"}], ",", 
               RowBox[{"y", "===", "yy"}]}], "]"}], ",", 
             RowBox[{"2", "^", 
              RowBox[{"XYToSquare", "[", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y"}], "}"}], "]"}]}], ",", "0"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"y", ",", "0", ",", "7"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "0", ",", "7"}], "}"}]}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RookMaskEXT", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", ",", "y", ",", 
         RowBox[{"a", "=", 
          RowBox[{"NOT", "[", 
           RowBox[{"BitOr", "[", 
            RowBox[{"BitsN", ",", "BitsS", ",", "BitsW", ",", "BitsE"}], 
            "]"}], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "y"}], "}"}], "=", 
         RowBox[{"SquareToXY", "[", "sq", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"y", "===", "0"}], ",", 
          RowBox[{"a", "=", 
           RowBox[{"BitOr", "[", 
            RowBox[{"a", ",", "BitsN"}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"y", "===", "7"}], ",", 
          RowBox[{"a", "=", 
           RowBox[{"BitOr", "[", 
            RowBox[{"a", ",", "BitsS"}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"x", "===", "0"}], ",", 
          RowBox[{"a", "=", 
           RowBox[{"BitOr", "[", 
            RowBox[{"a", ",", "BitsW"}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"x", "===", "7"}], ",", 
          RowBox[{"a", "=", 
           RowBox[{"BitOr", "[", 
            RowBox[{"a", ",", "BitsE"}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"BitAnd", "[", 
         RowBox[{
          RowBox[{"RookMaskDEP", "[", "sq", "]"}], ",", 
          RowBox[{"BitAnd", "[", 
           RowBox[{"a", ",", 
            RowBox[{"NOT", "[", "BitsCorners", "]"}]}], "]"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RookMaskLOOKUP", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"RookMaskLOOKUP", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"board", ",", "x", ",", "a", ",", "b"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"board", "=", 
            RowBox[{"PDEP", "[", 
             RowBox[{"i", ",", 
              RowBox[{"RookMaskEXT", "[", "sq", "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"x", "=", "0"}], ";", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "=", "sq"}], ";", 
              RowBox[{"b", "=", "1"}], ";", "\[IndentingNewLine]", 
              RowBox[{"While", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"a", "=", 
                  RowBox[{"GoDirection", "[", 
                   RowBox[{"a", ",", "dir"}], "]"}]}], ";", 
                 RowBox[{"a", "<", "64"}]}], ",", 
                RowBox[{
                 RowBox[{"x", "+=", 
                  RowBox[{"b", "*", 
                   RowBox[{"2", "^", "a"}]}]}], ";", 
                 RowBox[{"b", "=", 
                  RowBox[{"BitAnd", "[", 
                   RowBox[{"b", ",", 
                    RowBox[{
                    RowBox[{"BitGet", "[", 
                    RowBox[{"board", ",", "a"}], "]"}], "-", "1"}]}], 
                   "]"}]}]}]}], "]"}], ";"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"dir", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"+", "1"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"+", "1"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "}"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"PEXT", "[", 
            RowBox[{"x", ",", 
             RowBox[{"RookMaskDEP", "[", "sq", "]"}]}], "]"}]}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", 
            RowBox[{
             RowBox[{"2", "^", 
              RowBox[{"POPCNT", "[", 
               RowBox[{"RookMaskEXT", "[", "sq", "]"}], "]"}]}], "-", "1"}]}],
            "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RookAttacks", "[", 
    RowBox[{"sq_", ",", "occ_"}], "]"}], ":=", 
   RowBox[{"PDEP", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"RookMaskLOOKUP", "[", "sq", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"1", "+", 
       RowBox[{"PEXT", "[", 
        RowBox[{"occ", ",", 
         RowBox[{"RookMaskEXT", "[", "sq", "]"}]}], "]"}]}], 
      "\[RightDoubleBracket]"}], ",", 
     RowBox[{"RookMaskDEP", "[", "sq", "]"}]}], "]"}]}], ";"}]}], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["bishop attacks", "Subsection",
 CellChangeTimes->{{3.6095240903813295`*^9, 3.609524093744522*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Remove", "[", 
   RowBox[{
   "BishopMaskEXT", ",", "BishopMaskDEP", ",", "BishopMaskLOOKUP", ",", 
    "BishopAttacks"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BishopMaskDEP", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"BishopMaskDEP", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"xx", ",", "yy"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"xx", ",", "yy"}], "}"}], "=", 
          RowBox[{"SquareToXY", "[", "sq", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Xor", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"x", "+", "y"}], "===", 
                RowBox[{"xx", "+", "yy"}]}], ",", 
               RowBox[{
                RowBox[{"x", "-", "y"}], "===", 
                RowBox[{"xx", "-", "yy"}]}]}], "]"}], ",", 
             RowBox[{"2", "^", 
              RowBox[{"XYToSquare", "[", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y"}], "}"}], "]"}]}], ",", "0"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"y", ",", "0", ",", "7"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "0", ",", "7"}], "}"}]}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BishopMaskEXT", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"BishopMaskEXT", "[", "sq", "]"}], "=", 
      RowBox[{"BitAnd", "[", 
       RowBox[{
        RowBox[{"BishopMaskDEP", "[", "sq", "]"}], ",", 
        RowBox[{"NOT", "[", 
         RowBox[{"BitOr", "[", 
          RowBox[{"BitsN", ",", "BitsS", ",", "BitsW", ",", "BitsE"}], "]"}], 
         "]"}]}], "]"}]}]}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BishopMaskLOOKUP", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"BishopMaskLOOKUP", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"board", ",", "x", ",", "a", ",", "b"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"board", "=", 
            RowBox[{"PDEP", "[", 
             RowBox[{"i", ",", 
              RowBox[{"BishopMaskEXT", "[", "sq", "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"x", "=", "0"}], ";", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "=", "sq"}], ";", 
              RowBox[{"b", "=", "1"}], ";", "\[IndentingNewLine]", 
              RowBox[{"While", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"a", "=", 
                  RowBox[{"GoDirection", "[", 
                   RowBox[{"a", ",", "dir"}], "]"}]}], ";", 
                 RowBox[{"a", "<", "64"}]}], ",", 
                RowBox[{
                 RowBox[{"x", "+=", 
                  RowBox[{"b", "*", 
                   RowBox[{"2", "^", "a"}]}]}], ";", 
                 RowBox[{"b", "=", 
                  RowBox[{"BitAnd", "[", 
                   RowBox[{"b", ",", 
                    RowBox[{
                    RowBox[{"BitGet", "[", 
                    RowBox[{"board", ",", "a"}], "]"}], "-", "1"}]}], 
                   "]"}]}]}]}], "]"}], ";"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"dir", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"+", "1"}], ",", 
                   RowBox[{"+", "1"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", 
                   RowBox[{"+", "1"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"+", "1"}], ",", 
                   RowBox[{"-", "1"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", 
                   RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "}"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"PEXT", "[", 
            RowBox[{"x", ",", 
             RowBox[{"BishopMaskDEP", "[", "sq", "]"}]}], "]"}]}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", 
            RowBox[{
             RowBox[{"2", "^", 
              RowBox[{"POPCNT", "[", 
               RowBox[{"BishopMaskEXT", "[", "sq", "]"}], "]"}]}], "-", 
             "1"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
    ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BishopAttacks", "[", 
    RowBox[{"sq_", ",", "occ_"}], "]"}], ":=", 
   RowBox[{"PDEP", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"BishopMaskLOOKUP", "[", "sq", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"1", "+", 
       RowBox[{"PEXT", "[", 
        RowBox[{"occ", ",", 
         RowBox[{"BishopMaskEXT", "[", "sq", "]"}]}], "]"}]}], 
      "\[RightDoubleBracket]"}], ",", 
     RowBox[{"BishopMaskDEP", "[", "sq", "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6096858368044734`*^9, 3.609685837740527*^9}, {
  3.6096884181471176`*^9, 3.6096884272876406`*^9}, {3.609694086450326*^9, 
  3.6096940871143637`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["queen attacks", "Subsection",
 CellChangeTimes->{{3.609524095902645*^9, 3.6095241065522547`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Remove", "[", "QueenAttacks", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"QueenAttacks", "[", 
    RowBox[{"sq_", ",", "occ_"}], "]"}], ":=", 
   RowBox[{"BitOr", "[", 
    RowBox[{
     RowBox[{"BishopAttacks", "[", 
      RowBox[{"sq", ",", "occ"}], "]"}], ",", 
     RowBox[{"RookAttacks", "[", 
      RowBox[{"sq", ",", "occ"}], "]"}]}], "]"}]}], ";"}]}], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["king attacks", "Subsection",
 CellChangeTimes->{{3.6095240812728086`*^9, 3.609524115087743*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Remove", "[", "KingAttacks", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KingAttacks", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"KingAttacks", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", "=", "0"}], ",", "a"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "=", 
               RowBox[{"GoDirection", "[", 
                RowBox[{"sq", ",", "dir"}], "]"}]}], ";", 
              RowBox[{"a", "<", "64"}]}], ",", 
             RowBox[{"x", "+=", 
              RowBox[{"2", "^", "a"}]}]}], "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"dir", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"+", "1"}], ",", 
                 RowBox[{"+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"+", "1"}], ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"+", "1"}], ",", 
                 RowBox[{"-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", 
                 RowBox[{"+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", 
                 RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "x"}]}], "]"}]}]}], ")"}]}], ";"}]}], "Input",
 CellChangeTimes->{3.6095256142214885`*^9, 3.6095258658688817`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["knight attacks", "Subsection",
 CellChangeTimes->{{3.6095240903813295`*^9, 3.6095241196160016`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Remove", "[", "KnightAttacks", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KnightAttacks", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"KnightAttacks", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", "=", "0"}], ",", "a"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "=", 
               RowBox[{"GoDirection", "[", 
                RowBox[{"sq", ",", "dir"}], "]"}]}], ";", 
              RowBox[{"a", "<", "64"}]}], ",", 
             RowBox[{"x", "+=", 
              RowBox[{"2", "^", "a"}]}]}], "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"dir", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"+", "2"}], ",", 
                 RowBox[{"+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"+", "2"}], ",", 
                 RowBox[{"-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "2"}], ",", 
                 RowBox[{"+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "2"}], ",", 
                 RowBox[{"-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"+", "1"}], ",", 
                 RowBox[{"+", "2"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", 
                 RowBox[{"+", "2"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"+", "1"}], ",", 
                 RowBox[{"-", "2"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", 
                 RowBox[{"-", "2"}]}], "}"}]}], "}"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "x"}]}], "]"}]}]}], ")"}]}], ";"}]}], "Input",
 CellChangeTimes->{3.6095247935195465`*^9, 3.60952561320343*^9, 
  3.60952586706695*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["pawn attacks", "Subsection",
 CellChangeTimes->{{3.609524095902645*^9, 3.6095241065522547`*^9}, {
  3.60952438726231*^9, 3.6095243891584187`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Remove", "[", 
   RowBox[{
   "WhitePawnAttacks", ",", "BlackPawnAttacks", ",", "WhitePawnMoves", ",", 
    "BlackPawnMoves"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WhitePawnAttacks", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"WhitePawnAttacks", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", "=", "0"}], ",", "a"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "=", 
               RowBox[{"GoDirection", "[", 
                RowBox[{"sq", ",", "dir"}], "]"}]}], ";", 
              RowBox[{"a", "<", "64"}]}], ",", 
             RowBox[{"x", "+=", 
              RowBox[{"2", "^", "a"}]}]}], "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"dir", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"+", "1"}], ",", 
                 RowBox[{"-", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", 
                 RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "x"}]}], "]"}]}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlackPawnAttacks", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"BlackPawnAttacks", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", "=", "0"}], ",", "a"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "=", 
               RowBox[{"GoDirection", "[", 
                RowBox[{"sq", ",", "dir"}], "]"}]}], ";", 
              RowBox[{"a", "<", "64"}]}], ",", 
             RowBox[{"x", "+=", 
              RowBox[{"2", "^", "a"}]}]}], "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"dir", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"+", "1"}], ",", 
                 RowBox[{"+", "1"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", 
                 RowBox[{"+", "1"}]}], "}"}]}], "}"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "x"}]}], "]"}]}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WhitePawnMoves", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"WhitePawnMoves", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", "=", "0"}], ",", "a"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "=", 
               RowBox[{"GoDirection", "[", 
                RowBox[{"sq", ",", "dir"}], "]"}]}], ";", 
              RowBox[{"a", "<", "64"}]}], ",", 
             RowBox[{"x", "+=", 
              RowBox[{"2", "^", "a"}]}]}], "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"dir", ",", 
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"-", "1"}]}], "}"}], "}"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "x"}]}], "]"}]}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlackPawnMoves", "[", "sq_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{"sq", "<", "64"}], "]"}], ";", 
     RowBox[{
      RowBox[{"BlackPawnMoves", "[", "sq", "]"}], "=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", "=", "0"}], ",", "a"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"a", "=", 
               RowBox[{"GoDirection", "[", 
                RowBox[{"sq", ",", "dir"}], "]"}]}], ";", 
              RowBox[{"a", "<", "64"}]}], ",", 
             RowBox[{"x", "+=", 
              RowBox[{"2", "^", "a"}]}]}], "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"dir", ",", 
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"+", "1"}]}], "}"}], "}"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "x"}]}], "]"}]}]}], ")"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6095252853486776`*^9, 3.609525290840992*^9}, {
  3.609525517938981*^9, 3.6095255439134665`*^9}, {3.6095255936813135`*^9, 
  3.609525624205059*^9}, {3.609525673099856*^9, 3.6095257158182993`*^9}, {
  3.609525764923108*^9, 3.609525780771014*^9}, {3.609591611225668*^9, 
  3.6095916693589926`*^9}, {3.609620889572251*^9, 3.60962090704525*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["position setup", "Section",
 CellChangeTimes->{{3.609526576247513*^9, 3.6095265806627655`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"WPIECES", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WPAWNS", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WKNIGHTS", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WBISHOPS", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WROOKS", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WQUEENS", "=", "6"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WKING", "=", "7"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BPIECES", "=", "9"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BPAWNS", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BKNIGHTS", "=", "11"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BBISHOPS", "=", "12"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BROOKS", "=", "13"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BQUEENS", "=", "14"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BKING", "=", "15"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EPSQUARE", "=", "17"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CASTLING", "=", "18"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SIDE", "=", "19"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CHECK", "=", "20"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MOVES", "=", "21"}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.609526286040914*^9, 3.6095264316212406`*^9}, {
  3.609526484988293*^9, 3.6095264992041063`*^9}, {3.6095265489479513`*^9, 
  3.6095265597315683`*^9}, {3.6095280469826345`*^9, 3.609528104668934*^9}, {
  3.6095285859034586`*^9, 3.609528590894744*^9}, {3.609528749312805*^9, 
  3.6095287509779005`*^9}, {3.6095291286115*^9, 3.609529181617532*^9}, {
  3.6095292182856293`*^9, 3.6095292240049562`*^9}, {3.6095328080959544`*^9, 
  3.6095328253079386`*^9}, {3.6096202911070204`*^9, 3.609620332227372*^9}, {
  3.6096203742347755`*^9, 3.6096204667970695`*^9}, {3.609620658673044*^9, 
  3.609620662768278*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Remove", "[", 
    RowBox[{
    "BoardMatrixToPosition", ",", "PrintWhiteMove", ",", "PrintBlackMove", 
     ",", "SquareToString", ",", "PrintPosition"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PrintPosition", "[", "pos_", "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"\"\<WPIECES\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WPIECES", "\[RightDoubleBracket]"}],
           "]"}], "]"}], ",", "\[IndentingNewLine]", "\"\<WPAWNS\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WPAWNS", "\[RightDoubleBracket]"}], 
          "]"}], "]"}], ",", "\[IndentingNewLine]", "\"\<WKNIGHTS\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
           "\[RightDoubleBracket]"}], "]"}], "]"}], ",", 
        "\[IndentingNewLine]", "\"\<WBISHOPS\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
           "\[RightDoubleBracket]"}], "]"}], "]"}], ",", 
        "\[IndentingNewLine]", "\"\<WQUEENS\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WQUEENS", "\[RightDoubleBracket]"}],
           "]"}], "]"}], ",", "\[IndentingNewLine]", "\"\<WKING\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WKING", "\[RightDoubleBracket]"}], 
          "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<BPIECES\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BPIECES", "\[RightDoubleBracket]"}],
           "]"}], "]"}], ",", "\[IndentingNewLine]", "\"\<BPAWNS\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BPAWNS", "\[RightDoubleBracket]"}], 
          "]"}], "]"}], ",", "\[IndentingNewLine]", "\"\<BKNIGHTS\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
           "\[RightDoubleBracket]"}], "]"}], "]"}], ",", 
        "\[IndentingNewLine]", "\"\<BBISHOPS\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
           "\[RightDoubleBracket]"}], "]"}], "]"}], ",", 
        "\[IndentingNewLine]", "\"\<BQUEENS\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BQUEENS", "\[RightDoubleBracket]"}],
           "]"}], "]"}], ",", "\[IndentingNewLine]", "\"\<BKING\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BKING", "\[RightDoubleBracket]"}], 
          "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<EPSQUARE\>\"", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{"BitBoardToMatrix", "[", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "EPSQUARE", 
           "\[RightDoubleBracket]"}], "]"}], "]"}]}], "]"}], ";"}], 
     "\[IndentingNewLine]", ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BoardMatrixToPosition", "[", 
     RowBox[{"board_List", ",", "castling_", ",", "ep_", ",", "side_"}], 
     "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"a", ",", "i", ",", 
        RowBox[{"b", "=", 
         RowBox[{"Flatten", "[", "board", "]"}]}], ",", 
        RowBox[{"pos", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", "MOVES", "}"}]}], "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"b", "\[LeftDoubleBracket]", 
            RowBox[{"1", "+", "i"}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Which", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"a", "===", "\"\<P\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WPAWNS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPAWNS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<Q\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WQUEENS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WQUEENS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<R\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WROOKS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WROOKS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<B\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<N\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<K\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WKING", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WKING", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<p\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BPAWNS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BPAWNS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<q\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BQUEENS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BQUEENS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<r\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BROOKS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BROOKS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<b\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<n\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"a", "===", "\"\<k\>\""}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BPIECES", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BPIECES", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "BKING", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"BitSet", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "BKING", 
                 "\[RightDoubleBracket]"}], ",", "i"}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", "True", ",", "Null"}], "]"}]}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", "63"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "CASTLING", "\[RightDoubleBracket]"}], 
        "=", 
        RowBox[{"BitAnd", "[", 
         RowBox[{"castling", ",", "15"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "EPSQUARE", "\[RightDoubleBracket]"}], 
        "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"0", "\[LessEqual]", "ep", "<", "64"}], ",", 
          RowBox[{"2", "^", "ep"}], ",", "0"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "SIDE", "\[RightDoubleBracket]"}], "=", 
        RowBox[{"BitAnd", "[", 
         RowBox[{"side", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "pos"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PositionToBoardMatrix", "[", "pos_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Assert", "[", 
        RowBox[{"PartitionQ", "[", 
         RowBox[{
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WPIECES", "\[RightDoubleBracket]"}],
           ",", 
          RowBox[{"pos", "\[LeftDoubleBracket]", 
           RowBox[{"{", 
            RowBox[{
            "WPAWNS", ",", "WKNIGHTS", ",", "WBISHOPS", ",", "WROOKS", ",", 
             "WQUEENS", ",", "WKING"}], "}"}], "\[RightDoubleBracket]"}]}], 
         "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Assert", "[", 
        RowBox[{"PartitionQ", "[", 
         RowBox[{
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BPIECES", "\[RightDoubleBracket]"}],
           ",", 
          RowBox[{"pos", "\[LeftDoubleBracket]", 
           RowBox[{"{", 
            RowBox[{
            "BPAWNS", ",", "BKNIGHTS", ",", "BBISHOPS", ",", "BROOKS", ",", 
             "BQUEENS", ",", "BKING"}], "}"}], "\[RightDoubleBracket]"}]}], 
         "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Assert", "[", 
        RowBox[{"DisjointQ", "[", 
         RowBox[{"pos", "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{"WPIECES", ",", "BPIECES", ",", "EPSQUARE"}], "}"}], 
          "\[RightDoubleBracket]"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Grid", "[", 
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Which", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "WPAWNS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<P\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<N\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<B\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "WROOKS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<R\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "WQUEENS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<Q\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "WKING", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<K\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "BPAWNS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<p\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<n\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<b\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "BROOKS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<r\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "BQUEENS", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<q\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "BKING", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<k\>\"", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"BitGet", "[", 
                  RowBox[{
                   RowBox[{
                   "pos", "\[LeftDoubleBracket]", "EPSQUARE", 
                    "\[RightDoubleBracket]"}], ",", "i"}], "]"}], "=!=", 
                 "0"}], ",", "\"\<e\>\"", ",", "\[IndentingNewLine]", "True", 
                ",", "\"\< \>\""}], "\[IndentingNewLine]", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "0", ",", "63"}], "}"}]}], "]"}], ",", "8"}],
            "]"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "CASTLING", "\[RightDoubleBracket]"}],
          ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
            "pos", "\[LeftDoubleBracket]", "EPSQUARE", 
             "\[RightDoubleBracket]"}], "=!=", "0"}], ",", 
           RowBox[{"BSF", "[", 
            RowBox[{
            "pos", "\[LeftDoubleBracket]", "EPSQUARE", 
             "\[RightDoubleBracket]"}], "]"}], ",", "64"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"BitAnd", "[", 
          RowBox[{
           RowBox[{
           "pos", "\[LeftDoubleBracket]", "SIDE", "\[RightDoubleBracket]"}], 
           ",", "1"}], "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SquareToString", "[", "sq_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Assert", "[", 
       RowBox[{"0", "\[LessEqual]", "sq", "<", "64"}], "]"}], ";", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "\"\<a\>\"", ",", "\"\<b\>\"", ",", "\"\<c\>\"", ",", "\"\<d\>\"", 
           ",", "\"\<e\>\"", ",", "\"\<f\>\"", ",", "\"\<g\>\"", ",", 
           "\"\<h\>\""}], "}"}], "\[LeftDoubleBracket]", 
         RowBox[{"1", "+", 
          RowBox[{"BitAnd", "[", 
           RowBox[{"sq", ",", "7"}], "]"}]}], "\[RightDoubleBracket]"}], 
        ")"}], "<>", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "\"\<8\>\"", ",", "\"\<7\>\"", ",", "\"\<6\>\"", ",", "\"\<5\>\"", 
           ",", "\"\<4\>\"", ",", "\"\<3\>\"", ",", "\"\<2\>\"", ",", 
           "\"\<1\>\""}], "}"}], "\[LeftDoubleBracket]", 
         RowBox[{"1", "+", 
          RowBox[{"BitShiftRight", "[", 
           RowBox[{"sq", ",", "3"}], "]"}]}], "\[RightDoubleBracket]"}], 
        ")"}]}]}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PrintWhiteMove", "[", "move_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "f", ",", "t", ",", "F", ",", "T", ",", "tf", ",", "cr", ",", "sz"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"f", "=", 
        RowBox[{"BitAnd", "[", 
         RowBox[{
          RowBox[{"BitShiftRight", "[", 
           RowBox[{"move", ",", "MbitFROM"}], "]"}], ",", "63"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"t", "=", 
        RowBox[{"BitAnd", "[", 
         RowBox[{
          RowBox[{"BitShiftRight", "[", 
           RowBox[{"move", ",", "MbitTO"}], "]"}], ",", "63"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"F", "=", 
        RowBox[{"BitAnd", "[", 
         RowBox[{
          RowBox[{"BitShiftRight", "[", 
           RowBox[{"move", ",", "MbitFROMP"}], "]"}], ",", "7"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"sz", "=", 
        RowBox[{
         RowBox[{"SquareToString", "[", "f", "]"}], "<>", 
         RowBox[{"SquareToString", "[", "t", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"normal", " ", "move"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"BitAnd", "[", 
           RowBox[{"move", ",", 
            RowBox[{
             RowBox[{"BitShiftLeft", "[", 
              RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
             RowBox[{"BitShiftLeft", "[", 
              RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], "===", "0"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "sz", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", "promotion", " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"BitAnd", "[", 
           RowBox[{"move", ",", 
            RowBox[{
             RowBox[{"BitShiftLeft", "[", 
              RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
             RowBox[{"BitShiftLeft", "[", 
              RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], "===", 
          RowBox[{"BitShiftLeft", "[", 
           RowBox[{"3", ",", "MbitPROM"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Assert", "[", 
           RowBox[{"KNIGHT", "\[LessEqual]", "F", "\[LessEqual]", "QUEEN"}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"sz", "<>", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "\"\<?\>\"", ",", "\"\<n\>\"", ",", "\"\<b\>\"", ",", 
               "\"\<r\>\"", ",", "\"\<q\>\"", ",", "\"\<?\>\"", ",", 
               "\"\<?\>\""}], "}"}], "\[LeftDoubleBracket]", "F", 
             "\[RightDoubleBracket]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", "castling", " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"BitAnd", "[", 
           RowBox[{"move", ",", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
          RowBox[{"BitShiftLeft", "[", 
           RowBox[{"1", ",", "MbitTYPE"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Assert", "[", 
           RowBox[{"Or", "[", 
            RowBox[{
             RowBox[{"f", "===", "0"}], ",", 
             RowBox[{"f", "===", "1"}]}], "]"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<e1g1\>\"", ",", "\"\<e1c1\>\""}], "}"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"1", "+", "f"}], "\[RightDoubleBracket]"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"pawn", " ", "double", " ", "move"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"BitAnd", "[", 
           RowBox[{"move", ",", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
          RowBox[{"BitShiftLeft", "[", 
           RowBox[{"2", ",", "MbitTYPE"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "sz", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"ep", " ", "capture"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"BitAnd", "[", 
           RowBox[{"move", ",", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
          RowBox[{"BitShiftLeft", "[", 
           RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "sz", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"should", " ", "not", " ", "happen"}], " ", "*)"}], 
         "\[IndentingNewLine]", "True", ",", "\[IndentingNewLine]", 
         RowBox[{"Assert", "[", "False", "]"}]}], "\[IndentingNewLine]", 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintBlackMove", "[", "move_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "f", ",", "t", ",", "F", ",", "T", ",", "tf", ",", "cr", ",", "sz"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"f", "=", 
      RowBox[{"BitAnd", "[", 
       RowBox[{
        RowBox[{"BitShiftRight", "[", 
         RowBox[{"move", ",", "MbitFROM"}], "]"}], ",", "63"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"t", "=", 
      RowBox[{"BitAnd", "[", 
       RowBox[{
        RowBox[{"BitShiftRight", "[", 
         RowBox[{"move", ",", "MbitTO"}], "]"}], ",", "63"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"F", "=", 
      RowBox[{"BitAnd", "[", 
       RowBox[{
        RowBox[{"BitShiftRight", "[", 
         RowBox[{"move", ",", "MbitFROMP"}], "]"}], ",", "7"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sz", "=", 
      RowBox[{
       RowBox[{"SquareToString", "[", "f", "]"}], "<>", 
       RowBox[{"SquareToString", "[", "t", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"normal", " ", "move"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"BitAnd", "[", 
         RowBox[{"move", ",", 
          RowBox[{
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], "===", "0"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "sz", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", "promotion", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"BitAnd", "[", 
         RowBox[{"move", ",", 
          RowBox[{
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], "===", 
        RowBox[{"BitShiftLeft", "[", 
         RowBox[{"3", ",", "MbitPROM"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Assert", "[", 
         RowBox[{"KNIGHT", "\[LessEqual]", "F", "\[LessEqual]", "QUEEN"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"sz", "<>", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "\"\<?\>\"", ",", "\"\<n\>\"", ",", "\"\<b\>\"", ",", "\"\<r\>\"",
              ",", "\"\<q\>\"", ",", "\"\<?\>\"", ",", "\"\<?\>\""}], "}"}], 
           "\[LeftDoubleBracket]", "F", "\[RightDoubleBracket]"}]}], "]"}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", "castling", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"BitAnd", "[", 
         RowBox[{"move", ",", 
          RowBox[{"BitShiftLeft", "[", 
           RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
        RowBox[{"BitShiftLeft", "[", 
         RowBox[{"1", ",", "MbitTYPE"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Assert", "[", 
         RowBox[{"Or", "[", 
          RowBox[{
           RowBox[{"f", "===", "2"}], ",", 
           RowBox[{"f", "===", "3"}]}], "]"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<e8g8\>\"", ",", "\"\<e8c8\>\""}], "}"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"1", "+", "f", "-", "2"}], "\[RightDoubleBracket]"}], 
         "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pawn", " ", "double", " ", "move"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"BitAnd", "[", 
         RowBox[{"move", ",", 
          RowBox[{"BitShiftLeft", "[", 
           RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
        RowBox[{"BitShiftLeft", "[", 
         RowBox[{"2", ",", "MbitTYPE"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "sz", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"ep", " ", "capture"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"BitAnd", "[", 
         RowBox[{"move", ",", 
          RowBox[{"BitShiftLeft", "[", 
           RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
        RowBox[{"BitShiftLeft", "[", 
         RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "sz", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"should", " ", "not", " ", "happen"}], " ", "*)"}], 
       "\[IndentingNewLine]", "True", ",", "\[IndentingNewLine]", 
       RowBox[{"Assert", "[", "False", "]"}]}], "\[IndentingNewLine]", "]"}], 
     ";"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.6096335154453297`*^9, 3.6096335438429546`*^9}, {
   3.609633746703557*^9, 3.609633753132925*^9}, {3.60963406687787*^9, 
   3.6096340750153356`*^9}, {3.6096343563614273`*^9, 
   3.6096343573734856`*^9}, {3.6096346020874825`*^9, 3.609634618795438*^9}, {
   3.6096347067184668`*^9, 3.609634720123234*^9}, {3.6096347634707127`*^9, 
   3.6096347886871552`*^9}, {3.6096348675306644`*^9, 3.609634920502695*^9}, 
   3.6096350015383296`*^9, {3.609635066292033*^9, 3.609635109826524*^9}, {
   3.609635593378181*^9, 3.60963564564017*^9}, {3.6096357250027094`*^9, 
   3.6096357353233*^9}, {3.609635911665386*^9, 3.609635924098097*^9}, {
   3.609636502867201*^9, 3.609636534360002*^9}, {3.609636581042672*^9, 
   3.6096366538838387`*^9}, {3.609636859065574*^9, 3.6096369167788754`*^9}, {
   3.609637007659073*^9, 3.60963706511436*^9}, {3.609637185089222*^9, 
   3.609637214714916*^9}, {3.609637288713149*^9, 3.6096373070311966`*^9}, {
   3.609638075133129*^9, 3.6096380962993402`*^9}, {3.6096391713758307`*^9, 
   3.609639172686906*^9}, {3.6096392513854074`*^9, 3.60963932836581*^9}, {
   3.6096394677147803`*^9, 3.6096394687378387`*^9}, {3.6096461316429353`*^9, 
   3.6096461964776435`*^9}, {3.609646242967303*^9, 3.6096462485946245`*^9}, {
   3.60964633611063*^9, 3.6096463861564927`*^9}, {3.6096464856381826`*^9, 
   3.609646579194534*^9}, {3.6096466844935565`*^9, 3.60964671776746*^9}, {
   3.609646845731779*^9, 3.60964691062049*^9}, {3.6096469613773937`*^9, 
   3.6096469807184997`*^9}, {3.6096471259888086`*^9, 3.609647151992296*^9}, {
   3.6096476800845013`*^9, 3.6096476951683636`*^9}, {3.6096773316036253`*^9, 
   3.609677370878872*^9}, {3.609677426257039*^9, 3.609677563303878*^9}, {
   3.6096777466633654`*^9, 3.609677771653795*^9}, {3.6096793922603135`*^9, 
   3.6096794099195447`*^9}, {3.60967945250762*^9, 3.6096794557212253`*^9}, {
   3.6096795482467885`*^9, 3.6096796208949437`*^9}, {3.6096799949513383`*^9, 
   3.609679998591547*^9}, {3.6096805003262444`*^9, 3.6096805507491283`*^9}, {
   3.609680754792799*^9, 3.6096807680355563`*^9}, {3.6096808069687834`*^9, 
   3.6096808249248104`*^9}, {3.6096819294839873`*^9, 
   3.6096819692772636`*^9}, {3.6096825573809013`*^9, 3.609682593877989*^9}, {
   3.609682675635665*^9, 3.6096827434015408`*^9}, {3.6096833589037457`*^9, 
   3.6096833912805977`*^9}, {3.6096834837918887`*^9, 
   3.6096835214430428`*^9}, {3.609683707764699*^9, 3.6096837089817686`*^9}, {
   3.6096852288417*^9, 3.609685284642892*^9}, {3.6096853559979725`*^9, 
   3.6096853565300035`*^9}, {3.6096854723476276`*^9, 3.609685472579641*^9}, {
   3.60968550613356*^9, 3.6096855063315716`*^9}, {3.609702472452978*^9, 
   3.609702496124332*^9}, {3.6097179238350296`*^9, 3.6097179299383783`*^9}, {
   3.60971796282926*^9, 3.6097179907288556`*^9}, {3.6097199151169243`*^9, 
   3.6097199302317886`*^9}, {3.6097201850313625`*^9, 3.609720200000219*^9}, {
   3.609720258155545*^9, 3.6097202826029434`*^9}, {3.609731156311928*^9, 
   3.6097315093981237`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["move generation", "Section",
 CellChangeTimes->{{3.6095257963179035`*^9, 3.6095258037443285`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MbitFROM", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MbitTO", "=", "6"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MbitPROM", "=", "12"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MbitTYPE", " ", "=", " ", "14"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MbitFROMP", "=", "16"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MbitTOP", "=", 
    RowBox[{"16", "+", "3"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PAWN", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"KNIGHT", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BISHOP", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ROOK", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"QUEEN", " ", "=", " ", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KING", " ", "=", " ", "6"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MbitsWhiteOO", "=", 
   RowBox[{
    RowBox[{"BitShiftLeft", "[", 
     RowBox[{"0", ",", "MbitFROM"}], "]"}], "+", 
    RowBox[{"BitShiftLeft", "[", 
     RowBox[{"0", ",", "MbitTO"}], "]"}], "+", 
    RowBox[{"BitShiftLeft", "[", 
     RowBox[{"1", ",", "MbitTYPE"}], " ", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MbitsWhiteOOO", "=", 
   RowBox[{
    RowBox[{"BitShiftLeft", "[", 
     RowBox[{"1", ",", "MbitFROM"}], "]"}], "+", 
    RowBox[{"BitShiftLeft", "[", 
     RowBox[{"1", ",", "MbitTO"}], "]"}], "+", 
    RowBox[{"BitShiftLeft", "[", 
     RowBox[{"1", ",", "MbitTYPE"}], " ", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MbitsBlackOO", "=", 
   RowBox[{
    RowBox[{"BitShiftLeft", "[", 
     RowBox[{"2", ",", "MbitFROM"}], "]"}], "+", 
    RowBox[{"BitShiftLeft", "[", 
     RowBox[{"2", ",", "MbitTO"}], "]"}], "+", 
    RowBox[{"BitShiftLeft", "[", 
     RowBox[{"1", ",", "MbitTYPE"}], " ", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MbitsBlackOOO", "=", 
    RowBox[{
     RowBox[{"BitShiftLeft", "[", 
      RowBox[{"3", ",", "MbitFROM"}], "]"}], "+", 
     RowBox[{"BitShiftLeft", "[", 
      RowBox[{"3", ",", "MbitTO"}], "]"}], "+", 
     RowBox[{"BitShiftLeft", "[", 
      RowBox[{"1", ",", "MbitTYPE"}], " ", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", " ", 
   RowBox[{
   "32", " ", "bit", " ", "move", " ", "structure", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "normal", " ", "moves", "\[IndentingNewLine]", 
    "ssssssssssTTTFFF00ppttttttffffff", "\[IndentingNewLine]", "ssssssssss", "                          ",
     "ranking", "\[IndentingNewLine]", "          ", "TTT", "                       ",
     "peice", " ", "on", " ", "destination", " ", "square", 
    "\[IndentingNewLine]", "             ", "FFF", "                    ", 
    "peice", " ", "on", " ", "source", " ", "square", "\[IndentingNewLine]", 
    "                  ", "pp", "                ", "promotion", " ", "piece",
     "         ", "must", " ", "be", " ", "zero", " ", "for", " ", "non", " ",
     "promotion", "   ", "11", " ", "for", " ", "promotions", "  ", 
    "promotion", " ", "peice", " ", "stored", " ", "in", " ", "FFF", 
    "\[IndentingNewLine]", "                    ", "tttttt", "          ", 
    "destination", " ", "square", "\[IndentingNewLine]", 
    "                          ", "ffffff", "    ", "source", " ", "square", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "castling", 
    "\[IndentingNewLine]", "ssssssssss0000000100000000000000", "   ", "white",
     " ", "OO", "\[IndentingNewLine]", "ssssssssss0000000100000001000001", "   ",
     "white", " ", "OOO", "\[IndentingNewLine]", 
    "ssssssssss0000000100000002000002", "   ", "black", " ", "OO", 
    "\[IndentingNewLine]", "ssssssssss0000000100000003000003", "   ", "black",
     " ", "OOO", "\[IndentingNewLine]", "\[IndentingNewLine]", "pawn", " ", 
    "double", " ", "move", "\[IndentingNewLine]", 
    "ssssssssssdddddd1000ttttttffffff", "\[IndentingNewLine]", "ssssssssss", "                          ",
     "ranking", "\[IndentingNewLine]", "                    ", "tttttt", "          ",
     "destination", " ", "square", "\[IndentingNewLine]", 
    "                          ", "ffffff", "    ", "source", " ", "square", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "ep", " ", "capture", 
    "\[IndentingNewLine]", "ssssssssssdddddd1100ttttttffffff", 
    "\[IndentingNewLine]", "ssssssssss", "                          ", 
    "ranking", "\[IndentingNewLine]", "                    ", "tttttt", "          ",
     "destination", " ", "square", "  ", "ep", " ", "square", 
    "\[IndentingNewLine]", "                          ", "ffffff", "    ", 
    "source", " ", "square"}], "\[IndentingNewLine]", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.609618968207355*^9, 3.6096190087516737`*^9}, 
   3.609619169037842*^9, {3.609619421832301*^9, 3.609619432531913*^9}, {
   3.609619708322687*^9, 3.6096197381503935`*^9}, {3.6096197829579563`*^9, 
   3.609619789725343*^9}, {3.6096200001363783`*^9, 3.6096200098799353`*^9}, {
   3.609621115113151*^9, 3.6096211171992702`*^9}, {3.6096213656374803`*^9, 
   3.6096213666035357`*^9}, {3.6096215208303566`*^9, 3.609621521382388*^9}, {
   3.6096224163685784`*^9, 3.609622422216913*^9}, {3.609622969016188*^9, 
   3.609622980004817*^9}, {3.6096231926919813`*^9, 3.6096232325592623`*^9}, {
   3.6096293791317463`*^9, 3.609629383059971*^9}, {3.609629434703925*^9, 
   3.609629443763443*^9}, {3.609685385602666*^9, 3.6096853860476913`*^9}}],

Cell[CellGroupData[{

Cell["coverage", "Subsection",
 CellChangeTimes->{{3.609528954143521*^9, 3.6095289578427324`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Remove", "[", 
   RowBox[{"WhiteCoverage", ",", "BlackCoverage"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WhiteCoverage", "[", "pos_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", 
       RowBox[{"c", "=", "0"}], ",", 
       RowBox[{"d", "=", 
        RowBox[{"BitOr", "[", 
         RowBox[{
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WPIECES", "\[RightDoubleBracket]"}],
           ",", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BPIECES", 
           "\[RightDoubleBracket]"}]}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "WPAWNS", "\[RightDoubleBracket]"}]}], 
      ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"WhitePawnAttacks", "[", "b", "]"}]}], "]"}]}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "WKNIGHTS", "\[RightDoubleBracket]"}]}],
       ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"KnightAttacks", "[", "b", "]"}]}], "]"}]}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "WBISHOPS", "\[RightDoubleBracket]"}]}],
       ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"BishopAttacks", "[", 
             RowBox[{"b", ",", "d"}], "]"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "WROOKS", "\[RightDoubleBracket]"}]}], 
      ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"RookAttacks", "[", 
             RowBox[{"b", ",", "d"}], "]"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "WQUEENS", "\[RightDoubleBracket]"}]}], 
      ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"QueenAttacks", "[", 
             RowBox[{"b", ",", "d"}], "]"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{"BSF", "[", 
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "WKING", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", 
      RowBox[{"c", "=", 
       RowBox[{"BitOr", "[", 
        RowBox[{"c", ",", 
         RowBox[{"KingAttacks", "[", "b", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "c"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlackCoverage", "[", "pos_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", 
       RowBox[{"c", "=", "0"}], ",", 
       RowBox[{"d", "=", 
        RowBox[{"BitOr", "[", 
         RowBox[{
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WPIECES", "\[RightDoubleBracket]"}],
           ",", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BPIECES", 
           "\[RightDoubleBracket]"}]}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BPAWNS", "\[RightDoubleBracket]"}]}], 
      ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"BlackPawnAttacks", "[", "b", "]"}]}], "]"}]}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BKNIGHTS", "\[RightDoubleBracket]"}]}],
       ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"KnightAttacks", "[", "b", "]"}]}], "]"}]}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BBISHOPS", "\[RightDoubleBracket]"}]}],
       ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"BishopAttacks", "[", 
             RowBox[{"b", ",", "d"}], "]"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BROOKS", "\[RightDoubleBracket]"}]}], 
      ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"RookAttacks", "[", 
             RowBox[{"b", ",", "d"}], "]"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BQUEENS", "\[RightDoubleBracket]"}]}], 
      ";", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"a", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"BSF", "[", "a", "]"}]}], ";", 
         RowBox[{"a", "=", 
          RowBox[{"BLSR", "[", "a", "]"}]}], ";", 
         RowBox[{"c", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{"c", ",", 
            RowBox[{"QueenAttacks", "[", 
             RowBox[{"b", ",", "d"}], "]"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{"BSF", "[", 
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "BKING", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", 
      RowBox[{"c", "=", 
       RowBox[{"BitOr", "[", 
        RowBox[{"c", ",", 
         RowBox[{"KingAttacks", "[", "b", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "c"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.609526661231374*^9, 3.609526682535592*^9}, {
   3.609526774577857*^9, 3.609526780506196*^9}, {3.6095268191424055`*^9, 
   3.6095268589056797`*^9}, {3.609526990308196*^9, 3.609526992933346*^9}, {
   3.6095274427790756`*^9, 3.609527481014263*^9}, {3.60952771804482*^9, 
   3.60952771962091*^9}, {3.6095279929105415`*^9, 3.6095279944136276`*^9}, {
   3.6095281467333393`*^9, 3.609528288575453*^9}, {3.6095284668236475`*^9, 
   3.609528467265673*^9}, {3.609528500221558*^9, 3.60952881338947*^9}, {
   3.609529066172929*^9, 3.609529066596953*^9}, {3.6095290996288424`*^9, 
   3.6095291246002703`*^9}, 3.6095326839368525`*^9, {3.609589154441148*^9, 
   3.6095892211259623`*^9}, {3.609589257495042*^9, 3.6095892580470734`*^9}, {
   3.6095893790289936`*^9, 3.6095894278257847`*^9}, {3.609621074637836*^9, 
   3.6096210785120573`*^9}, {3.6097214105284567`*^9, 3.609721424338247*^9}, {
   3.609721601916404*^9, 3.6097216024214325`*^9}, {3.609721694936724*^9, 
   3.609721697064846*^9}, {3.60972174486658*^9, 3.609721778842523*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["pseudo legal moves", "Subsection",
 CellChangeTimes->{{3.609528963586061*^9, 3.6095289733826213`*^9}, {
   3.60953332920376*^9, 3.6095333992147646`*^9}, {3.609533562273091*^9, 
   3.609533584077338*^9}, 3.609533685908162*^9, {3.609619176384262*^9, 
   3.60961917652027*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Remove", "[", 
    RowBox[{
    "PseudoLegalMoves", ",", "WhitePseudoLegalMoves", ",", 
     "BlackPseudoLegalMoves"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PseudoLegalMoves", "[", "pos_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"BitAnd", "[", 
         RowBox[{
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "SIDE", "\[RightDoubleBracket]"}], 
          ",", "1"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"BlackPseudoLegalMoves", "[", "pos", "]"}], ",", 
       RowBox[{"WhitePseudoLegalMoves", "[", "pos", "]"}]}], "]"}], ")"}]}], 
   ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"WhitePseudoLegalMoves", "[", "pos_List", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Batt", "=", "0"}], ",", 
        RowBox[{"list", "=", 
         RowBox[{"{", "}"}]}], ",", "F", ",", "f", ",", "T", ",", "t", ",", 
        "tp", ",", "a", ",", "b", ",", "c", ",", 
        RowBox[{"occ", "=", 
         RowBox[{"BitOr", "[", 
          RowBox[{
           RowBox[{
           "pos", "\[LeftDoubleBracket]", "WPIECES", 
            "\[RightDoubleBracket]"}], ",", 
           RowBox[{
           "pos", "\[LeftDoubleBracket]", "BPIECES", 
            "\[RightDoubleBracket]"}]}], "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<generating white moves\>\"", "]"}], ";"}], 
       "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<white: \>\"", ",", 
          RowBox[{"Grid", "[", 
           RowBox[{"BitBoardToMatrix", "[", 
            RowBox[{"WhiteCoverage", "[", "pos", "]"}], "]"}], "]"}]}], "]"}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<black: \>\"", ",", 
          RowBox[{"Grid", "[", 
           RowBox[{"BitBoardToMatrix", "[", 
            RowBox[{"BlackCoverage", "[", "pos", "]"}], "]"}], "]"}]}], "]"}],
         ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"generate", " ", "normal", " ", "moves"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"F", "=", 
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "WQUEENS", "\[RightDoubleBracket]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"F", "=!=", "0"}], ",", 
         RowBox[{
          RowBox[{"f", "=", 
           RowBox[{"BSF", "[", "F", "]"}]}], ";", 
          RowBox[{"F", "=", 
           RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
          RowBox[{"T", "=", 
           RowBox[{"ANDN", "[", 
            RowBox[{
             RowBox[{
             "pos", "\[LeftDoubleBracket]", "WPIECES", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{"QueenAttacks", "[", 
              RowBox[{"f", ",", "occ"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{"T", ",", 
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BKING", 
                "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
            RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{"T", "=!=", "0"}], ",", 
            RowBox[{
             RowBox[{"t", "=", 
              RowBox[{"BSF", "[", "T", "]"}]}], ";", 
             RowBox[{"T", "=", 
              RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"tp", "=", 
              RowBox[{
               RowBox[{"PAWN", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BPAWNS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"KNIGHT", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"BISHOP", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"ROOK", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BROOKS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"QUEEN", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BQUEENS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"list", ",", 
               RowBox[{
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"QUEEN", ",", "MbitFROMP"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], 
           "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"F", "=", 
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "WROOKS", "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"F", "=!=", "0"}], ",", 
         RowBox[{
          RowBox[{"f", "=", 
           RowBox[{"BSF", "[", "F", "]"}]}], ";", 
          RowBox[{"F", "=", 
           RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
          RowBox[{"T", "=", 
           RowBox[{"ANDN", "[", 
            RowBox[{
             RowBox[{
             "pos", "\[LeftDoubleBracket]", "WPIECES", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{"RookAttacks", "[", 
              RowBox[{"f", ",", "occ"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{"T", ",", 
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BKING", 
                "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
            RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{"T", "=!=", "0"}], ",", 
            RowBox[{
             RowBox[{"t", "=", 
              RowBox[{"BSF", "[", "T", "]"}]}], ";", 
             RowBox[{"T", "=", 
              RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"tp", "=", 
              RowBox[{
               RowBox[{"PAWN", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BPAWNS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"KNIGHT", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"BISHOP", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"ROOK", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BROOKS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"QUEEN", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BQUEENS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"list", ",", 
               RowBox[{
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"ROOK", ",", "MbitFROMP"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], 
           "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"F", "=", 
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"F", "=!=", "0"}], ",", 
         RowBox[{
          RowBox[{"f", "=", 
           RowBox[{"BSF", "[", "F", "]"}]}], ";", 
          RowBox[{"F", "=", 
           RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
          RowBox[{"T", "=", 
           RowBox[{"ANDN", "[", 
            RowBox[{
             RowBox[{
             "pos", "\[LeftDoubleBracket]", "WPIECES", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{"BishopAttacks", "[", 
              RowBox[{"f", ",", "occ"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{"T", ",", 
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BKING", 
                "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
            RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{"T", "=!=", "0"}], ",", 
            RowBox[{
             RowBox[{"t", "=", 
              RowBox[{"BSF", "[", "T", "]"}]}], ";", 
             RowBox[{"T", "=", 
              RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"tp", "=", 
              RowBox[{
               RowBox[{"PAWN", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BPAWNS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"KNIGHT", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"BISHOP", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"ROOK", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BROOKS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"QUEEN", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BQUEENS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"list", ",", 
               RowBox[{
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"BISHOP", ",", "MbitFROMP"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], 
           "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"F", "=", 
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"F", "=!=", "0"}], ",", 
         RowBox[{
          RowBox[{"f", "=", 
           RowBox[{"BSF", "[", "F", "]"}]}], ";", 
          RowBox[{"F", "=", 
           RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
          RowBox[{"T", "=", 
           RowBox[{"ANDN", "[", 
            RowBox[{
             RowBox[{
             "pos", "\[LeftDoubleBracket]", "WPIECES", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{"KnightAttacks", "[", "f", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{"T", ",", 
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BKING", 
                "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
            RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{"T", "=!=", "0"}], ",", 
            RowBox[{
             RowBox[{"t", "=", 
              RowBox[{"BSF", "[", "T", "]"}]}], ";", 
             RowBox[{"T", "=", 
              RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"tp", "=", 
              RowBox[{
               RowBox[{"PAWN", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BPAWNS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"KNIGHT", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"BISHOP", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"ROOK", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BROOKS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
               RowBox[{"QUEEN", "*", 
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "BQUEENS", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"list", ",", 
               RowBox[{
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"KNIGHT", ",", "MbitFROMP"}], "]"}], "+", 
                RowBox[{"BitShiftLeft", "[", 
                 RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], 
           "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"F", "=", 
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "WPAWNS", "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"F", "=!=", "0"}], ",", 
         RowBox[{
          RowBox[{"f", "=", 
           RowBox[{"BSF", "[", "F", "]"}]}], ";", 
          RowBox[{"F", "=", 
           RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
          RowBox[{"T", "=", 
           RowBox[{"ANDN", "[", 
            RowBox[{
             RowBox[{
             "pos", "\[LeftDoubleBracket]", "WPIECES", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{"WhitePawnAttacks", "[", "f", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{"T", ",", 
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BKING", 
                "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
            RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"T", "=", 
           RowBox[{"BitOr", "[", 
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{"T", ",", 
               RowBox[{"BitOr", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "EPSQUARE", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "BPIECES", 
                  "\[RightDoubleBracket]"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"ANDN", "[", 
              RowBox[{"occ", ",", 
               RowBox[{"WhitePawnMoves", "[", "f", "]"}]}], "]"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{"T", "=!=", "0"}], ",", 
            RowBox[{
             RowBox[{"t", "=", 
              RowBox[{"BSF", "[", "T", "]"}]}], ";", 
             RowBox[{"T", "=", 
              RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"BitGet", "[", 
                 RowBox[{
                  RowBox[{
                  "pos", "\[LeftDoubleBracket]", "EPSQUARE", 
                   "\[RightDoubleBracket]"}], ",", "t"}], "]"}], "===", "0"}],
                ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"tp", "=", 
                 RowBox[{
                  RowBox[{"PAWN", "*", 
                   RowBox[{"BitGet", "[", 
                    RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "BPAWNS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
                  RowBox[{"KNIGHT", "*", 
                   RowBox[{"BitGet", "[", 
                    RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
                  RowBox[{"BISHOP", "*", 
                   RowBox[{"BitGet", "[", 
                    RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
                  RowBox[{"ROOK", "*", 
                   RowBox[{"BitGet", "[", 
                    RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "BROOKS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
                  RowBox[{"QUEEN", "*", 
                   RowBox[{"BitGet", "[", 
                    RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "BQUEENS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"BitGet", "[", 
                    RowBox[{"BitsN", ",", "t"}], "]"}], "===", "0"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", " ", 
                   RowBox[{
                   "generate", " ", "normal", " ", "pawn", " ", "move"}], " ",
                    "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"list", ",", 
                    RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"PAWN", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", " ", 
                   RowBox[{"generate", " ", "pawn", " ", "promotion"}], " ", 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AppendTo", "[", 
                    RowBox[{"list", ",", 
                    RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"QUEEN", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"AppendTo", "[", 
                    RowBox[{"list", ",", 
                    RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"ROOK", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"AppendTo", "[", 
                    RowBox[{"list", ",", 
                    RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"BISHOP", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"AppendTo", "[", 
                    RowBox[{"list", ",", 
                    RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"KNIGHT", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], ";"}]}],
                  "\[IndentingNewLine]", "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"generate", " ", "ep", " ", "capture"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"list", ",", 
                 RowBox[{
                  RowBox[{"BitShiftLeft", "[", 
                   RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                  RowBox[{"BitShiftLeft", "[", 
                   RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                  RowBox[{"BitShiftLeft", "[", 
                   RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
                  RowBox[{"BitShiftLeft", "[", 
                   RowBox[{"PAWN", ",", "MbitFROMP"}], "]"}], "+", 
                  RowBox[{"BitShiftLeft", "[", 
                   RowBox[{"PAWN", ",", "MbitTOP"}], "]"}]}]}], "]"}]}], 
              "\[IndentingNewLine]", "]"}]}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"f", "=", 
        RowBox[{"BSF", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "WKING", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", 
       RowBox[{"T", "=", 
        RowBox[{"ANDN", "[", 
         RowBox[{
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WPIECES", "\[RightDoubleBracket]"}],
           ",", 
          RowBox[{"KingAttacks", "[", "f", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"BitAnd", "[", 
           RowBox[{"T", ",", 
            RowBox[{
            "pos", "\[LeftDoubleBracket]", "BKING", 
             "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
         RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"T", "=!=", "0"}], ",", 
         RowBox[{
          RowBox[{"t", "=", 
           RowBox[{"BSF", "[", "T", "]"}]}], ";", 
          RowBox[{"T", "=", 
           RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"tp", "=", 
           RowBox[{
            RowBox[{"PAWN", "*", 
             RowBox[{"BitGet", "[", 
              RowBox[{
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BPAWNS", 
                "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
            RowBox[{"KNIGHT", "*", 
             RowBox[{"BitGet", "[", 
              RowBox[{
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BKNIGHTS", 
                "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
            RowBox[{"BISHOP", "*", 
             RowBox[{"BitGet", "[", 
              RowBox[{
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BBISHOPS", 
                "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
            RowBox[{"ROOK", "*", 
             RowBox[{"BitGet", "[", 
              RowBox[{
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BROOKS", 
                "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
            RowBox[{"QUEEN", "*", 
             RowBox[{"BitGet", "[", 
              RowBox[{
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "BQUEENS", 
                "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"list", ",", 
            RowBox[{
             RowBox[{"BitShiftLeft", "[", 
              RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
             RowBox[{"BitShiftLeft", "[", 
              RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
             RowBox[{"BitShiftLeft", "[", 
              RowBox[{"KING", ",", "MbitFROMP"}], "]"}], "+", 
             RowBox[{"BitShiftLeft", "[", 
              RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"generate", " ", "castling", " ", "moves"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"And", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "CASTLING", 
               "\[RightDoubleBracket]"}], ",", "3"}], "]"}], "=!=", "0"}], 
           ",", 
           RowBox[{"Or", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"BitAnd", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "WhiteOOMask"}], "]"}], "===",
               "0"}], ",", 
             RowBox[{
              RowBox[{"BitAnd", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "WhiteOOOMask"}], "]"}], "===",
               "0"}]}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"c", "=", 
           RowBox[{"BlackCoverage", "[", "pos", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{
               RowBox[{"BitOr", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WPIECES", 
                  "\[RightDoubleBracket]"}], ",", "c"}], "]"}], ",", 
               "WhiteOOMask"}], "]"}], "===", "0"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", "MbitsWhiteOO"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{
               RowBox[{"BitOr", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WPIECES", 
                  "\[RightDoubleBracket]"}], ",", "c"}], "]"}], ",", 
               "WhiteOOOMask"}], "]"}], "===", "0"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", "MbitsWhiteOOO"}], "]"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"generate", " ", "double", " ", "pawn", " ", "moves"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"F", "=", 
        RowBox[{"BitAnd", "[", 
         RowBox[{"BitsRank2", ",", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WPAWNS", 
           "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"F", "=!=", "0"}], ",", 
         RowBox[{
          RowBox[{"f", "=", 
           RowBox[{"BSF", "[", "F", "]"}]}], ";", 
          RowBox[{"F", "=", 
           RowBox[{"BLSR", "[", "F", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"And", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"BitGet", "[", 
                RowBox[{"occ", ",", 
                 RowBox[{"f", "-", "8"}]}], "]"}], "===", "0"}], ",", 
              RowBox[{
               RowBox[{"BitGet", "[", 
                RowBox[{"occ", ",", 
                 RowBox[{"f", "-", "16"}]}], "]"}], "===", "0"}]}], "]"}], 
            ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", 
              RowBox[{
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{
                 RowBox[{"f", "-", "16"}], ",", "MbitTO"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"2", ",", "MbitTYPE"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"PAWN", ",", "MbitFROMP"}], "]"}]}]}], "]"}]}], 
           "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", "list"}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlackPseudoLegalMoves", "[", "pos_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Batt", "=", "0"}], ",", 
       RowBox[{"list", "=", 
        RowBox[{"{", "}"}]}], ",", "F", ",", "f", ",", "T", ",", "t", ",", 
       "tp", ",", "a", ",", "b", ",", "c", ",", 
       RowBox[{"occ", "=", 
        RowBox[{"BitOr", "[", 
         RowBox[{
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "WPIECES", "\[RightDoubleBracket]"}],
           ",", 
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "BPIECES", 
           "\[RightDoubleBracket]"}]}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", "\"\<generating black moves\>\"", "]"}], ";"}], 
      "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"generate", " ", "normal", " ", "moves"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"F", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BQUEENS", "\[RightDoubleBracket]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"F", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"f", "=", 
          RowBox[{"BSF", "[", "F", "]"}]}], ";", 
         RowBox[{"F", "=", 
          RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
         RowBox[{"T", "=", 
          RowBox[{"ANDN", "[", 
           RowBox[{
            RowBox[{
            "pos", "\[LeftDoubleBracket]", "BPIECES", 
             "\[RightDoubleBracket]"}], ",", 
            RowBox[{"QueenAttacks", "[", 
             RowBox[{"f", ",", "occ"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{"T", ",", 
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WKING", 
               "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
           RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"T", "=!=", "0"}], ",", 
           RowBox[{
            RowBox[{"t", "=", 
             RowBox[{"BSF", "[", "T", "]"}]}], ";", 
            RowBox[{"T", "=", 
             RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"tp", "=", 
             RowBox[{
              RowBox[{"PAWN", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WPAWNS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"KNIGHT", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"BISHOP", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"ROOK", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WROOKS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"QUEEN", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WQUEENS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", 
              RowBox[{
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"QUEEN", ",", "MbitFROMP"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"F", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BROOKS", "\[RightDoubleBracket]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"F", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"f", "=", 
          RowBox[{"BSF", "[", "F", "]"}]}], ";", 
         RowBox[{"F", "=", 
          RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
         RowBox[{"T", "=", 
          RowBox[{"ANDN", "[", 
           RowBox[{
            RowBox[{
            "pos", "\[LeftDoubleBracket]", "BPIECES", 
             "\[RightDoubleBracket]"}], ",", 
            RowBox[{"RookAttacks", "[", 
             RowBox[{"f", ",", "occ"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{"T", ",", 
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WKING", 
               "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
           RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"T", "=!=", "0"}], ",", 
           RowBox[{
            RowBox[{"t", "=", 
             RowBox[{"BSF", "[", "T", "]"}]}], ";", 
            RowBox[{"T", "=", 
             RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"tp", "=", 
             RowBox[{
              RowBox[{"PAWN", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WPAWNS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"KNIGHT", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"BISHOP", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"ROOK", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WROOKS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"QUEEN", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WQUEENS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", 
              RowBox[{
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"ROOK", ",", "MbitFROMP"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"F", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BBISHOPS", "\[RightDoubleBracket]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"F", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"f", "=", 
          RowBox[{"BSF", "[", "F", "]"}]}], ";", 
         RowBox[{"F", "=", 
          RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
         RowBox[{"T", "=", 
          RowBox[{"ANDN", "[", 
           RowBox[{
            RowBox[{
            "pos", "\[LeftDoubleBracket]", "BPIECES", 
             "\[RightDoubleBracket]"}], ",", 
            RowBox[{"BishopAttacks", "[", 
             RowBox[{"f", ",", "occ"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{"T", ",", 
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WKING", 
               "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
           RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"T", "=!=", "0"}], ",", 
           RowBox[{
            RowBox[{"t", "=", 
             RowBox[{"BSF", "[", "T", "]"}]}], ";", 
            RowBox[{"T", "=", 
             RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"tp", "=", 
             RowBox[{
              RowBox[{"PAWN", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WPAWNS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"KNIGHT", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"BISHOP", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"ROOK", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WROOKS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"QUEEN", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WQUEENS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", 
              RowBox[{
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"BISHOP", ",", "MbitFROMP"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"F", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BKNIGHTS", "\[RightDoubleBracket]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"F", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"f", "=", 
          RowBox[{"BSF", "[", "F", "]"}]}], ";", 
         RowBox[{"F", "=", 
          RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
         RowBox[{"T", "=", 
          RowBox[{"ANDN", "[", 
           RowBox[{
            RowBox[{
            "pos", "\[LeftDoubleBracket]", "BPIECES", 
             "\[RightDoubleBracket]"}], ",", 
            RowBox[{"KnightAttacks", "[", "f", "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{"T", ",", 
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WKING", 
               "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
           RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"T", "=!=", "0"}], ",", 
           RowBox[{
            RowBox[{"t", "=", 
             RowBox[{"BSF", "[", "T", "]"}]}], ";", 
            RowBox[{"T", "=", 
             RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"tp", "=", 
             RowBox[{
              RowBox[{"PAWN", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WPAWNS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"KNIGHT", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"BISHOP", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"ROOK", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WROOKS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
              RowBox[{"QUEEN", "*", 
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "WQUEENS", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", 
              RowBox[{
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"KNIGHT", ",", "MbitFROMP"}], "]"}], "+", 
               RowBox[{"BitShiftLeft", "[", 
                RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"F", "=", 
       RowBox[{
       "pos", "\[LeftDoubleBracket]", "BPAWNS", "\[RightDoubleBracket]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"F", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"f", "=", 
          RowBox[{"BSF", "[", "F", "]"}]}], ";", 
         RowBox[{"F", "=", 
          RowBox[{"BLSR", "[", "F", "]"}]}], ";", 
         RowBox[{"T", "=", 
          RowBox[{"ANDN", "[", 
           RowBox[{
            RowBox[{
            "pos", "\[LeftDoubleBracket]", "BPIECES", 
             "\[RightDoubleBracket]"}], ",", 
            RowBox[{"BlackPawnAttacks", "[", "f", "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{"T", ",", 
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WKING", 
               "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
           RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"T", "=", 
          RowBox[{"BitOr", "[", 
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{"T", ",", 
              RowBox[{"BitOr", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "EPSQUARE", 
                 "\[RightDoubleBracket]"}], ",", 
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}]}], "]"}]}], "]"}], ",", 
            RowBox[{"ANDN", "[", 
             RowBox[{"occ", ",", 
              RowBox[{"BlackPawnMoves", "[", "f", "]"}]}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"T", "=!=", "0"}], ",", 
           RowBox[{
            RowBox[{"t", "=", 
             RowBox[{"BSF", "[", "T", "]"}]}], ";", 
            RowBox[{"T", "=", 
             RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"BitGet", "[", 
                RowBox[{
                 RowBox[{
                 "pos", "\[LeftDoubleBracket]", "EPSQUARE", 
                  "\[RightDoubleBracket]"}], ",", "t"}], "]"}], "===", "0"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"tp", "=", 
                RowBox[{
                 RowBox[{"PAWN", "*", 
                  RowBox[{"BitGet", "[", 
                   RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "WPAWNS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
                 RowBox[{"KNIGHT", "*", 
                  RowBox[{"BitGet", "[", 
                   RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
                 RowBox[{"BISHOP", "*", 
                  RowBox[{"BitGet", "[", 
                   RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
                 RowBox[{"ROOK", "*", 
                  RowBox[{"BitGet", "[", 
                   RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "WROOKS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
                 RowBox[{"QUEEN", "*", 
                  RowBox[{"BitGet", "[", 
                   RowBox[{
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "WQUEENS", 
                    "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"BitGet", "[", 
                   RowBox[{"BitsS", ",", "t"}], "]"}], "===", "0"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                  "generate", " ", "normal", " ", "pawn", " ", "move"}], " ", 
                  "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"list", ",", 
                   RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"PAWN", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{"generate", " ", "pawn", " ", "promotion"}], " ", 
                  "*)"}], "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"list", ",", 
                    RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"QUEEN", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"list", ",", 
                    RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"ROOK", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"list", ",", 
                    RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"BISHOP", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"list", ",", 
                    RowBox[{
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"KNIGHT", ",", "MbitFROMP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"tp", ",", "MbitTOP"}], "]"}], "+", 
                    RowBox[{"BitShiftLeft", "[", 
                    RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], ";"}]}],
                 "\[IndentingNewLine]", "]"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"generate", " ", "ep", " ", "capture"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"list", ",", 
                RowBox[{
                 RowBox[{"BitShiftLeft", "[", 
                  RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
                 RowBox[{"BitShiftLeft", "[", 
                  RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
                 RowBox[{"BitShiftLeft", "[", 
                  RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
                 RowBox[{"BitShiftLeft", "[", 
                  RowBox[{"PAWN", ",", "MbitFROMP"}], "]"}], "+", 
                 RowBox[{"BitShiftLeft", "[", 
                  RowBox[{"PAWN", ",", "MbitTOP"}], "]"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}]}]}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"f", "=", 
       RowBox[{"BSF", "[", 
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "BKING", "\[RightDoubleBracket]"}], 
        "]"}]}], ";", 
      RowBox[{"T", "=", 
       RowBox[{"ANDN", "[", 
        RowBox[{
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "BPIECES", "\[RightDoubleBracket]"}], 
         ",", 
         RowBox[{"KingAttacks", "[", "f", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"T", ",", 
           RowBox[{
           "pos", "\[LeftDoubleBracket]", "WKING", 
            "\[RightDoubleBracket]"}]}], "]"}], "=!=", "0"}], ",", 
        RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"T", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"t", "=", 
          RowBox[{"BSF", "[", "T", "]"}]}], ";", 
         RowBox[{"T", "=", 
          RowBox[{"BLSR", "[", "T", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tp", "=", 
          RowBox[{
           RowBox[{"PAWN", "*", 
            RowBox[{"BitGet", "[", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WPAWNS", 
               "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"KNIGHT", "*", 
            RowBox[{"BitGet", "[", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WKNIGHTS", 
               "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"BISHOP", "*", 
            RowBox[{"BitGet", "[", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WBISHOPS", 
               "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"ROOK", "*", 
            RowBox[{"BitGet", "[", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WROOKS", 
               "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"QUEEN", "*", 
            RowBox[{"BitGet", "[", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WQUEENS", 
               "\[RightDoubleBracket]"}], ",", "t"}], "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"list", ",", 
           RowBox[{
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"t", ",", "MbitTO"}], "]"}], "+", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"KING", ",", "MbitFROMP"}], "]"}], "+", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"tp", ",", "MbitTOP"}], "]"}]}]}], "]"}]}]}], "]"}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"generate", " ", "castling", " ", "moves"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"And", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"BitAnd", "[", 
            RowBox[{
             RowBox[{
             "pos", "\[LeftDoubleBracket]", "CASTLING", 
              "\[RightDoubleBracket]"}], ",", "12"}], "]"}], "=!=", "0"}], 
          ",", 
          RowBox[{"Or", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "WPIECES", 
                "\[RightDoubleBracket]"}], ",", "BlackOOMask"}], "]"}], "===",
              "0"}], ",", 
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "WPIECES", 
                "\[RightDoubleBracket]"}], ",", "BlackOOOMask"}], "]"}], "===",
              "0"}]}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"c", "=", 
          RowBox[{"WhiteCoverage", "[", "pos", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{
              RowBox[{"BitOr", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "c"}], "]"}], ",", 
              "BlackOOMask"}], "]"}], "===", "0"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"list", ",", "MbitsBlackOO"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{
              RowBox[{"BitOr", "[", 
               RowBox[{
                RowBox[{
                "pos", "\[LeftDoubleBracket]", "WPIECES", 
                 "\[RightDoubleBracket]"}], ",", "c"}], "]"}], ",", 
              "BlackOOOMask"}], "]"}], "===", "0"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"list", ",", "MbitsBlackOOO"}], "]"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"generate", " ", "double", " ", "pawn", " ", "moves"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"F", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{"BitsRank7", ",", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "BPAWNS", "\[RightDoubleBracket]"}]}],
         "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"F", "=!=", "0"}], ",", 
        RowBox[{
         RowBox[{"f", "=", 
          RowBox[{"BSF", "[", "F", "]"}]}], ";", 
         RowBox[{"F", "=", 
          RowBox[{"BLSR", "[", "F", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"And", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"BitGet", "[", 
               RowBox[{"occ", ",", 
                RowBox[{"f", "+", "8"}]}], "]"}], "===", "0"}], ",", 
             RowBox[{
              RowBox[{"BitGet", "[", 
               RowBox[{"occ", ",", 
                RowBox[{"f", "+", "16"}]}], "]"}], "===", "0"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"list", ",", 
             RowBox[{
              RowBox[{"BitShiftLeft", "[", 
               RowBox[{"f", ",", "MbitFROM"}], "]"}], "+", 
              RowBox[{"BitShiftLeft", "[", 
               RowBox[{
                RowBox[{"f", "+", "16"}], ",", "MbitTO"}], "]"}], "+", 
              RowBox[{"BitShiftLeft", "[", 
               RowBox[{"2", ",", "MbitTYPE"}], "]"}], "+", 
              RowBox[{"BitShiftLeft", "[", 
               RowBox[{"PAWN", ",", "MbitFROMP"}], "]"}]}]}], "]"}]}], 
          "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], ";",
       "\[IndentingNewLine]", "list"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.609532977223628*^9, 3.6095329795037584`*^9}, {
   3.6095330195990515`*^9, 3.60953302831855*^9}, {3.6095330957704086`*^9, 
   3.609533118858729*^9}, {3.6095332681192665`*^9, 3.6095332684322844`*^9}, 
   3.6095335456211386`*^9, {3.6095338066060658`*^9, 3.609533834251647*^9}, {
   3.6095338962901955`*^9, 3.609533925414861*^9}, {3.609533978942923*^9, 
   3.609533993981783*^9}, {3.609534093973502*^9, 3.6095341095423927`*^9}, {
   3.6095341828585863`*^9, 3.6095341914870796`*^9}, {3.609534248449338*^9, 
   3.609534331343079*^9}, {3.6095343654330287`*^9, 3.609534371002348*^9}, {
   3.6095344487887964`*^9, 3.6095346003674664`*^9}, {3.6095346455820527`*^9, 
   3.609534724969593*^9}, {3.609534762533742*^9, 3.609534790739355*^9}, {
   3.6095349557567935`*^9, 3.6095350554404955`*^9}, {3.6095350855382166`*^9, 
   3.609535178682544*^9}, {3.609535209158287*^9, 3.5843575265219564`*^9}, {
   3.6095866602964907`*^9, 3.609586721926016*^9}, {3.6095867582120914`*^9, 
   3.609586832895363*^9}, {3.6095869033513927`*^9, 3.609586913022946*^9}, {
   3.6095869510391207`*^9, 3.609586972687359*^9}, {3.609587051802884*^9, 
   3.6095870836547055`*^9}, {3.6095872658101244`*^9, 3.609587268240263*^9}, {
   3.6095873291217456`*^9, 3.609587349153891*^9}, {3.6095873886811523`*^9, 
   3.6095874525548058`*^9}, {3.60958750841*^9, 3.609587528482148*^9}, {
   3.6095875879115477`*^9, 3.6095876044214916`*^9}, {3.6095876623968077`*^9, 
   3.609587695341692*^9}, {3.609587983710186*^9, 3.6095880007381597`*^9}, {
   3.6095880506500144`*^9, 3.6095880518170815`*^9}, {3.609588124510239*^9, 
   3.609588128164448*^9}, {3.6095883307890377`*^9, 3.609588332067111*^9}, {
   3.609588376358644*^9, 3.6095883922405524`*^9}, {3.6095885168196783`*^9, 
   3.609588532711587*^9}, {3.609588893034196*^9, 3.609588915073457*^9}, {
   3.609589024424711*^9, 3.609589059945743*^9}, 3.60958910186314*^9, {
   3.6095896056259537`*^9, 3.6095896550747824`*^9}, {3.6095897973739214`*^9, 
   3.609589836523161*^9}, {3.609590266561757*^9, 3.6095903025718174`*^9}, {
   3.6095903638633227`*^9, 3.60959058078373*^9}, {3.6095906814834895`*^9, 
   3.6095907012306194`*^9}, {3.6095908156241617`*^9, 3.609590896586793*^9}, {
   3.609590946334638*^9, 3.6095909766403713`*^9}, {3.609591035554741*^9, 
   3.6095910683206153`*^9}, {3.609591120098577*^9, 3.609591187096409*^9}, 
   3.609591231282936*^9, {3.6095912664149456`*^9, 3.6095913412722273`*^9}, {
   3.609591382847605*^9, 3.609591402442726*^9}, {3.609591434559563*^9, 
   3.6095914387668037`*^9}, {3.609591502974476*^9, 3.609591545367901*^9}, {
   3.6095915783207855`*^9, 3.609591580426906*^9}, {3.6095918233478003`*^9, 
   3.6095919347531724`*^9}, {3.609592068778838*^9, 3.6095921179316497`*^9}, {
   3.609592180472227*^9, 3.609592198406253*^9}, {3.6095923129668055`*^9, 
   3.609592319103156*^9}, {3.6095924242551703`*^9, 3.6095924400160723`*^9}, {
   3.609592487439784*^9, 3.6095924888178635`*^9}, 3.6095925346544847`*^9, {
   3.609592565707261*^9, 3.609592630146947*^9}, {3.6095927370570617`*^9, 
   3.60959274018124*^9}, {3.6095927705549774`*^9, 3.609592783341709*^9}, {
   3.6095928773260846`*^9, 3.6095929017694826`*^9}, {3.6095930120067883`*^9, 
   3.609593117487821*^9}, {3.6095931638884754`*^9, 3.6095931690997734`*^9}, {
   3.6095932151504073`*^9, 3.609593411911661*^9}, {3.609593552338693*^9, 
   3.6095935839044986`*^9}, {3.6095936399157023`*^9, 
   3.6095936554305897`*^9}, {3.6095937662909307`*^9, 
   3.6095937677840157`*^9}, {3.6095938618103943`*^9, 3.609593912078269*^9}, {
   3.60959402818291*^9, 3.609594129076681*^9}, {3.6095941664378176`*^9, 
   3.609594176135372*^9}, {3.609594537620048*^9, 3.609594577711341*^9}, {
   3.609594709986907*^9, 3.60959471650628*^9}, {3.6095948758603945`*^9, 
   3.609594948304538*^9}, {3.609594999680476*^9, 3.6095950360325556`*^9}, {
   3.6095952645606265`*^9, 3.6095953813083043`*^9}, {3.609595442023777*^9, 
   3.609595489544495*^9}, {3.6095956330347023`*^9, 3.609595674732087*^9}, {
   3.609595957367253*^9, 3.6095959903931417`*^9}, {3.60961784532813*^9, 
   3.6096178879275665`*^9}, {3.6096182834381886`*^9, 3.609618395519599*^9}, {
   3.609618504084809*^9, 3.6096185470202646`*^9}, {3.6096185770319815`*^9, 
   3.609618577165989*^9}, {3.6096189646881533`*^9, 3.609618971113521*^9}, {
   3.609621620315047*^9, 3.6096216363739653`*^9}, 3.609621754161702*^9, {
   3.6096297510740204`*^9, 3.6096297741763415`*^9}, {3.6096328670042415`*^9, 
   3.609632867192252*^9}, {3.609677807667855*^9, 3.6096778103150063`*^9}, 
   3.609679362152261*^9, {3.609685960782564*^9, 3.6096859609375734`*^9}, {
   3.6096866149319797`*^9, 3.6096866158630333`*^9}, {3.609694294246211*^9, 
   3.6096942997905283`*^9}, {3.6096944957617373`*^9, 
   3.6096944961107574`*^9}, {3.609697943254923*^9, 3.609697947859186*^9}, {
   3.6096979988531027`*^9, 3.6096980158750763`*^9}, {3.6096980513011026`*^9, 
   3.609698091450399*^9}, {3.609698243670106*^9, 3.6096982486173887`*^9}, 
   3.6096983429577847`*^9, {3.6096986446970425`*^9, 3.609698696475004*^9}, {
   3.6096994555164194`*^9, 3.609699464307922*^9}, {3.609699500313981*^9, 
   3.609699500938017*^9}, {3.6096996699626846`*^9, 3.609699676224043*^9}, 
   3.6096997759367456`*^9, {3.60969982774671*^9, 3.609699833815057*^9}, {
   3.609700250436886*^9, 3.6097002788505116`*^9}, {3.609700334512695*^9, 
   3.6097003700827293`*^9}, {3.6097004740656767`*^9, 
   3.6097005210153623`*^9}, {3.609702686744235*^9, 3.609702710056568*^9}, {
   3.6097057297682858`*^9, 3.609705771503673*^9}, {3.6097058134550724`*^9, 
   3.6097058140341053`*^9}, {3.6097207107964344`*^9, 
   3.6097207140586214`*^9}, {3.609720854205637*^9, 3.6097208593609324`*^9}, {
   3.6097209154561405`*^9, 3.609720924752672*^9}, {3.609721090477151*^9, 
   3.6097211190017824`*^9}, {3.609721282233119*^9, 3.609721338755352*^9}, {
   3.609723212237092*^9, 3.609723213494164*^9}, {3.60973007272095*^9, 
   3.6097300992994704`*^9}, {3.6097303183900013`*^9, 3.609730323444291*^9}, {
   3.609730443636165*^9, 3.609730473705885*^9}, {3.609730590521567*^9, 
   3.6097306071435175`*^9}, {3.6097306671129475`*^9, 3.609730704242071*^9}, {
   3.6097307584071693`*^9, 3.609730772154956*^9}, {3.6097308576958485`*^9, 
   3.609730877080957*^9}, {3.60973186092723*^9, 3.609731884933603*^9}, {
   3.6097320778566375`*^9, 3.6097320781386538`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["making pseudo legal moves", "Subsection",
 CellChangeTimes->{{3.5843573773634253`*^9, 3.5843573861419272`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Remove", "[", 
    RowBox[{
    "MakePseudoLegalMove", ",", "WhiteMakePseudoLegalMove", ",", 
     "BlackMakePseudoLegalMove"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MakePseudoLegalMove", "[", 
     RowBox[{"pos_", ",", "move_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"BitAnd", "[", 
         RowBox[{
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "SIDE", "\[RightDoubleBracket]"}], 
          ",", "1"}], "]"}], "=!=", "0"}], ",", 
       RowBox[{"BlackMakePseudoLegalMove", "[", 
        RowBox[{"pos", ",", "move"}], "]"}], ",", 
       RowBox[{"WhiteMakePseudoLegalMove", "[", 
        RowBox[{"pos", ",", "move"}], "]"}]}], "]"}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WhiteMakePseudoLegalMove", "[", 
    RowBox[{"pos_List", ",", "move_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"newpos", "=", "pos"}], ",", "f", ",", "t", ",", "F", ",", "T",
        ",", "tf", ",", "cr"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{"BitShiftRight", "[", 
          RowBox[{"move", ",", "MbitFROM"}], "]"}], ",", "63"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{"BitShiftRight", "[", 
          RowBox[{"move", ",", "MbitTO"}], "]"}], ",", "63"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"F", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{"BitShiftRight", "[", 
          RowBox[{"move", ",", "MbitFROMP"}], "]"}], ",", "7"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"T", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{"BitShiftRight", "[", 
          RowBox[{"move", ",", "MbitTOP"}], "]"}], ",", "7"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cr", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{
         "CastlingRights", "\[LeftDoubleBracket]", "t", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{
         "CastlingRights", "\[LeftDoubleBracket]", "f", 
          "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tf", "=", 
       RowBox[{
        RowBox[{"2", "^", "t"}], "+", 
        RowBox[{"2", "^", "f"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "newpos", "\[LeftDoubleBracket]", "EPSQUARE", 
        "\[RightDoubleBracket]"}], "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "newpos", "\[LeftDoubleBracket]", "SIDE", "\[RightDoubleBracket]"}], 
       "=", 
       RowBox[{"BitXor", "[", 
        RowBox[{
         RowBox[{
         "newpos", "\[LeftDoubleBracket]", "SIDE", "\[RightDoubleBracket]"}], 
         ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"normal", " ", "move"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], "===", "0"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "F"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "F"}], "\[RightDoubleBracket]"}], ",", 
            "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "T"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "T"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "CASTLING", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitAnd", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "CASTLING", 
             "\[RightDoubleBracket]"}], ",", "cr"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "promotion", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], "===", 
         RowBox[{"BitShiftLeft", "[", 
          RowBox[{"3", ",", "MbitPROM"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], ",",
             "f"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "F"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitSet", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "F"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "T"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "T"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "CASTLING", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitAnd", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "CASTLING", 
             "\[RightDoubleBracket]"}], ",", "cr"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "castling", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
         RowBox[{"BitShiftLeft", "[", 
          RowBox[{"1", ",", "MbitTYPE"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Assert", "[", 
          RowBox[{"Or", "[", 
           RowBox[{
            RowBox[{"f", "===", "0"}], ",", 
            RowBox[{"f", "===", "1"}]}], "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "WKING", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"SquareG1", ",", "SquareC1"}], "}"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"1", "+", "f"}], "\[RightDoubleBracket]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "WROOKS", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "WROOKS", 
             "\[RightDoubleBracket]"}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"SquareH1", "+", "SquareF1"}], ",", 
               RowBox[{"SquareA1", "+", "SquareD1"}]}], "}"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"1", "+", "f"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "CASTLING", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitAnd", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "CASTLING", 
             "\[RightDoubleBracket]"}], ",", "12"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"pawn", " ", "double", " ", "move"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
         RowBox[{"BitShiftLeft", "[", 
          RowBox[{"2", ",", "MbitTYPE"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "WPIECES", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "WPIECES", 
             "\[RightDoubleBracket]"}], ",", "tf"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "EPSQUARE", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitSet", "[", 
           RowBox[{"0", ",", 
            RowBox[{"t", "+", "8"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"ep", " ", "capture"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
         RowBox[{"BitShiftLeft", "[", 
          RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], ",",
             "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{"t", "+", "8"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{"t", "+", "8"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"should", " ", "not", " ", "happen"}], " ", "*)"}], 
        "\[IndentingNewLine]", "True", ",", "\[IndentingNewLine]", 
        RowBox[{"Assert", "[", "False", "]"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<wpeices \>\"", ",", 
          RowBox[{"Grid", "[", 
           RowBox[{"BitBoardToMatrix", "[", 
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "WPIECES", 
             "\[RightDoubleBracket]"}], "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<wknights \>\"", ",", 
          RowBox[{"Grid", "[", 
           RowBox[{"BitBoardToMatrix", "[", 
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "KNIGHT"}], "\[RightDoubleBracket]"}], 
            "]"}], "]"}]}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Assert", "[", 
       RowBox[{"PartitionQ", "[", 
        RowBox[{
         RowBox[{
         "newpos", "\[LeftDoubleBracket]", "WPIECES", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{"newpos", "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{
           "WPAWNS", ",", "WKNIGHTS", ",", "WBISHOPS", ",", "WROOKS", ",", 
            "WQUEENS", ",", "WKING"}], "}"}], "\[RightDoubleBracket]"}]}], 
        "]"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Assert", "[", 
       RowBox[{"PartitionQ", "[", 
        RowBox[{
         RowBox[{
         "newpos", "\[LeftDoubleBracket]", "BPIECES", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{"newpos", "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{
           "BPAWNS", ",", "BKNIGHTS", ",", "BBISHOPS", ",", "BROOKS", ",", 
            "BQUEENS", ",", "BKING"}], "}"}], "\[RightDoubleBracket]"}]}], 
        "]"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Assert", "[", 
       RowBox[{"DisjointQ", "[", 
        RowBox[{"newpos", "\[LeftDoubleBracket]", 
         RowBox[{"{", 
          RowBox[{"WPIECES", ",", "BPIECES", ",", "EPSQUARE"}], "}"}], 
         "\[RightDoubleBracket]"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
      "newpos"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlackMakePseudoLegalMove", "[", 
    RowBox[{"pos_List", ",", "move_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"newpos", "=", "pos"}], ",", "f", ",", "t", ",", "F", ",", "T",
        ",", "tf", ",", "cr"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{"BitShiftRight", "[", 
          RowBox[{"move", ",", "MbitFROM"}], "]"}], ",", "63"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{"BitShiftRight", "[", 
          RowBox[{"move", ",", "MbitTO"}], "]"}], ",", "63"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"F", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{"BitShiftRight", "[", 
          RowBox[{"move", ",", "MbitFROMP"}], "]"}], ",", "7"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"T", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{"BitShiftRight", "[", 
          RowBox[{"move", ",", "MbitTOP"}], "]"}], ",", "7"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cr", "=", 
       RowBox[{"BitAnd", "[", 
        RowBox[{
         RowBox[{
         "CastlingRights", "\[LeftDoubleBracket]", "t", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{
         "CastlingRights", "\[LeftDoubleBracket]", "f", 
          "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tf", "=", 
       RowBox[{
        RowBox[{"2", "^", "t"}], "+", 
        RowBox[{"2", "^", "f"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "newpos", "\[LeftDoubleBracket]", "EPSQUARE", 
        "\[RightDoubleBracket]"}], "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "newpos", "\[LeftDoubleBracket]", "SIDE", "\[RightDoubleBracket]"}], 
       "=", 
       RowBox[{"BitXor", "[", 
        RowBox[{
         RowBox[{
         "newpos", "\[LeftDoubleBracket]", "SIDE", "\[RightDoubleBracket]"}], 
         ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"normal", " ", "move"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], "===", "0"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "F"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "F"}], "\[RightDoubleBracket]"}], ",", 
            "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "T"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "T"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "CASTLING", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitAnd", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "CASTLING", 
             "\[RightDoubleBracket]"}], ",", "cr"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "promotion", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitTYPE"}], "]"}], "+", 
            RowBox[{"BitShiftLeft", "[", 
             RowBox[{"3", ",", "MbitPROM"}], "]"}]}]}], "]"}], "===", 
         RowBox[{"BitShiftLeft", "[", 
          RowBox[{"3", ",", "MbitPROM"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], ",",
             "f"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "F"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitSet", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "F"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "T"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "T"}], "\[RightDoubleBracket]"}], ",", 
            "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "CASTLING", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitAnd", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "CASTLING", 
             "\[RightDoubleBracket]"}], ",", "cr"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "castling", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
         RowBox[{"BitShiftLeft", "[", 
          RowBox[{"1", ",", "MbitTYPE"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Assert", "[", 
          RowBox[{"Or", "[", 
           RowBox[{
            RowBox[{"f", "===", "2"}], ",", 
            RowBox[{"f", "===", "3"}]}], "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "BKING", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"SquareG1", ",", "SquareC1"}], "}"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"1", "+", "f", "-", "2"}], "\[RightDoubleBracket]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "BROOKS", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "BROOKS", 
             "\[RightDoubleBracket]"}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"SquareH8", "+", "SquareF8"}], ",", 
               RowBox[{"SquareA8", "+", "SquareD8"}]}], "}"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"1", "+", "f", "-", "2"}], "\[RightDoubleBracket]"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "CASTLING", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitAnd", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "CASTLING", 
             "\[RightDoubleBracket]"}], ",", "3"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"pawn", " ", "double", " ", "move"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
         RowBox[{"BitShiftLeft", "[", 
          RowBox[{"2", ",", "MbitTYPE"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "BPIECES", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "BPIECES", 
             "\[RightDoubleBracket]"}], ",", "tf"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "newpos", "\[LeftDoubleBracket]", "EPSQUARE", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitSet", "[", 
           RowBox[{"0", ",", 
            RowBox[{"t", "-", "8"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"ep", " ", "capture"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BitAnd", "[", 
          RowBox[{"move", ",", 
           RowBox[{"BitShiftLeft", "[", 
            RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], "]"}], "===", 
         RowBox[{"BitShiftLeft", "[", 
          RowBox[{"3", ",", "MbitTYPE"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"BPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitXor", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"BPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], ",",
             "tf"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "0"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{"t", "-", "8"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newpos", "\[LeftDoubleBracket]", 
           RowBox[{"WPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"BitClear", "[", 
           RowBox[{
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "PAWN"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{"t", "-", "8"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"should", " ", "not", " ", "happen"}], " ", "*)"}], 
        "\[IndentingNewLine]", "True", ",", "\[IndentingNewLine]", 
        RowBox[{"Assert", "[", "False", "]"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<wpeices \>\"", ",", 
          RowBox[{"Grid", "[", 
           RowBox[{"BitBoardToMatrix", "[", 
            RowBox[{
            "newpos", "\[LeftDoubleBracket]", "WPIECES", 
             "\[RightDoubleBracket]"}], "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<wknights \>\"", ",", 
          RowBox[{"Grid", "[", 
           RowBox[{"BitBoardToMatrix", "[", 
            RowBox[{"newpos", "\[LeftDoubleBracket]", 
             RowBox[{"WPIECES", "+", "KNIGHT"}], "\[RightDoubleBracket]"}], 
            "]"}], "]"}]}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Assert", "[", 
       RowBox[{"PartitionQ", "[", 
        RowBox[{
         RowBox[{
         "newpos", "\[LeftDoubleBracket]", "WPIECES", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{"newpos", "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{
           "WPAWNS", ",", "WKNIGHTS", ",", "WBISHOPS", ",", "WROOKS", ",", 
            "WQUEENS", ",", "WKING"}], "}"}], "\[RightDoubleBracket]"}]}], 
        "]"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Assert", "[", 
       RowBox[{"PartitionQ", "[", 
        RowBox[{
         RowBox[{
         "newpos", "\[LeftDoubleBracket]", "BPIECES", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{"newpos", "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{
           "BPAWNS", ",", "BKNIGHTS", ",", "BBISHOPS", ",", "BROOKS", ",", 
            "BQUEENS", ",", "BKING"}], "}"}], "\[RightDoubleBracket]"}]}], 
        "]"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Assert", "[", 
       RowBox[{"DisjointQ", "[", 
        RowBox[{"newpos", "\[LeftDoubleBracket]", 
         RowBox[{"{", 
          RowBox[{"WPIECES", ",", "BPIECES", ",", "EPSQUARE"}], "}"}], 
         "\[RightDoubleBracket]"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
      "newpos"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.609527635848119*^9, 3.584357437558868*^9}, {
   3.609618918407507*^9, 3.6096189423598766`*^9}, {3.6096192319224386`*^9, 
   3.609619238649823*^9}, {3.609620199328771*^9, 3.6096202023589444`*^9}, {
   3.609623346742793*^9, 3.60962338148578*^9}, {3.609623453680909*^9, 
   3.609623462752428*^9}, {3.6096235183046055`*^9, 3.609623554125654*^9}, {
   3.6096243175443196`*^9, 3.609624326551835*^9}, {3.6096246419558744`*^9, 
   3.609624655402644*^9}, {3.609624804157152*^9, 3.6096248118175907`*^9}, {
   3.609625104507331*^9, 3.609625154923215*^9}, {3.6096253167064686`*^9, 
   3.6096253168654776`*^9}, {3.6096255235242977`*^9, 
   3.6096255843327756`*^9}, {3.6096256961481714`*^9, 3.609625713747178*^9}, {
   3.609625753162432*^9, 3.609625770938449*^9}, {3.609625946195473*^9, 
   3.609625950722732*^9}, {3.609626475765763*^9, 3.6096264904026003`*^9}, {
   3.6096265886352186`*^9, 3.609626591119361*^9}, {3.609626629958582*^9, 
   3.6096266658036327`*^9}, {3.609626698767518*^9, 3.6096267288352375`*^9}, {
   3.60962684653997*^9, 3.6096268534513655`*^9}, {3.609626953419083*^9, 
   3.6096270737358856`*^9}, {3.6096271491421986`*^9, 3.609627245903733*^9}, 
   3.6096273216240635`*^9, {3.6096275898214035`*^9, 3.609627598613907*^9}, {
   3.6096277096292562`*^9, 3.6096277248931293`*^9}, {3.609628078049329*^9, 
   3.6096281568548365`*^9}, {3.6096282010933666`*^9, 
   3.6096282525773115`*^9}, {3.609628308250496*^9, 3.6096283487618127`*^9}, {
   3.6096286691041355`*^9, 3.609628690548362*^9}, {3.6096288637942705`*^9, 
   3.6096288979592247`*^9}, {3.6096289280679474`*^9, 
   3.6096289447849035`*^9}, {3.6096290793055973`*^9, 3.609629124182164*^9}, {
   3.6096294791704683`*^9, 3.609629504535919*^9}, {3.6096295937240205`*^9, 
   3.609629606876773*^9}, {3.609629936096603*^9, 3.609629951969511*^9}, {
   3.609630042895712*^9, 3.6096300618427954`*^9}, 3.60963011034857*^9, 
   3.609632885634307*^9, {3.6096395116122913`*^9, 3.6096395162085543`*^9}, {
   3.60963969970605*^9, 3.609639706261424*^9}, {3.609639831228572*^9, 
   3.6096398676576557`*^9}, {3.609640041642607*^9, 3.60964012561441*^9}, {
   3.6096405079022756`*^9, 3.609640582995571*^9}, 3.609640834978984*^9, {
   3.609640878362465*^9, 3.609640899395668*^9}, {3.6096409547578344`*^9, 
   3.6096409550568514`*^9}, {3.6096409946091137`*^9, 3.60964099891036*^9}, {
   3.6096429774365253`*^9, 3.6096430166297665`*^9}, {3.6096436442386637`*^9, 
   3.6096436577954392`*^9}, {3.6096436907653255`*^9, 
   3.6096436915593705`*^9}, {3.6096438285312047`*^9, 
   3.6096438303003063`*^9}, {3.6096439410096383`*^9, 3.609643941703678*^9}, {
   3.6096439911725073`*^9, 3.6096440073664336`*^9}, {3.6096442955149145`*^9, 
   3.6096443263006754`*^9}, {3.609644450908803*^9, 3.6096445378577757`*^9}, {
   3.609644728826699*^9, 3.6096447341930056`*^9}, {3.6096448459223967`*^9, 
   3.6096448460854053`*^9}, {3.6096451615384483`*^9, 
   3.6096451617104588`*^9}, {3.609645628390151*^9, 3.609645676151883*^9}, {
   3.6096458589313374`*^9, 3.60964588310972*^9}, 3.609646146883807*^9, {
   3.6096477114522953`*^9, 3.6096477130293856`*^9}, {3.6096861359605837`*^9, 
   3.6096861380497036`*^9}, {3.6096862181782866`*^9, 
   3.6096862262167463`*^9}, {3.6096862948286705`*^9, 
   3.6096863680248575`*^9}, {3.609686408264159*^9, 3.6096865904195776`*^9}, {
   3.6096867160297623`*^9, 3.6096867216620846`*^9}, {3.609688293637996*^9, 
   3.6096883001303673`*^9}, {3.6096946389879293`*^9, 
   3.6096946740269337`*^9}, {3.6096953878297606`*^9, 
   3.6096954338323917`*^9}, {3.609695618631962*^9, 3.609695648926695*^9}, {
   3.6096956886809683`*^9, 3.609695712976358*^9}, {3.6096957666224265`*^9, 
   3.609695771534707*^9}, {3.609696018378826*^9, 3.6096960432632494`*^9}, {
   3.6096962831869726`*^9, 3.609696283306979*^9}, {3.609701107182889*^9, 
   3.60970112800508*^9}, {3.6097011680243692`*^9, 3.609701175753811*^9}, {
   3.609701383981721*^9, 3.6097013843557425`*^9}, {3.6097060046630087`*^9, 
   3.609706004873021*^9}, {3.6097061653091974`*^9, 3.6097061733026543`*^9}, {
   3.6097066846419015`*^9, 3.6097066886611314`*^9}, {3.609716927915066*^9, 
   3.609716972727629*^9}, {3.609731627492878*^9, 3.6097316532753525`*^9}, {
   3.6097317062173805`*^9, 3.609731728305644*^9}, {3.609731772780188*^9, 
   3.609731786843992*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["evaluation", "Section",
 CellChangeTimes->{{3.6097254807713056`*^9, 3.6097254840484934`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MATESCORE", "=", "1000000"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Remove", "[", "EvaluatePosition", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EvaluatePosition", "[", "pos_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"0", "\[IndentingNewLine]", "+", 
     RowBox[{"900", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "WQUEENS", "\[RightDoubleBracket]"}], 
         "]"}], "-", 
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "BQUEENS", "\[RightDoubleBracket]"}], 
         "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
     RowBox[{"500", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "WROOKS", "\[RightDoubleBracket]"}], 
         "]"}], "-", 
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "BROOKS", "\[RightDoubleBracket]"}], 
         "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
     RowBox[{"300", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "WBISHOPS", "\[RightDoubleBracket]"}],
          "]"}], "-", 
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "BBISHOPS", "\[RightDoubleBracket]"}],
          "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
     RowBox[{"300", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "WKNIGHTS", "\[RightDoubleBracket]"}],
          "]"}], "-", 
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "BKNIGHTS", "\[RightDoubleBracket]"}],
          "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
     RowBox[{"100", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "WPAWNS", "\[RightDoubleBracket]"}], 
         "]"}], "-", 
        RowBox[{"POPCNT", "[", 
         RowBox[{
         "pos", "\[LeftDoubleBracket]", "BPAWNS", "\[RightDoubleBracket]"}], 
         "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
     RowBox[{"12", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"POPCNT", "[", 
         RowBox[{"WhiteCoverage", "[", "pos", "]"}], "]"}], "-", 
        RowBox[{"POPCNT", "[", 
         RowBox[{"BlackCoverage", "[", "pos", "]"}], "]"}]}], ")"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.609725540016694*^9, 3.6097255954928675`*^9}, {
   3.609725651976098*^9, 3.6097256544082375`*^9}, {3.6097257227401457`*^9, 
   3.6097258259050465`*^9}, {3.6097258750408564`*^9, 3.609725915085147*^9}, {
   3.6097259968388233`*^9, 3.609726037030122*^9}, 3.6097261318375444`*^9, {
   3.6097261976923113`*^9, 3.6097262011565094`*^9}, {3.609726387319157*^9, 
   3.609726395902648*^9}, {3.609728464459963*^9, 3.609728491910533*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["search", "Section",
 CellChangeTimes->{{3.6095257963179035`*^9, 3.6095258037443285`*^9}, {
  3.6097236721483974`*^9, 3.609723686672228*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Remove", "[", 
    RowBox[{
    "SearchPosition", ",", "WhiteSearchPosition", ",", 
     "BlackSearchPosition"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SearchPosition", "[", 
     RowBox[{
     "pos_", ",", "\[Alpha]_", ",", "\[Beta]_", ",", "depth_", ",", 
      "maxdepth_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"BitAnd", "[", 
         RowBox[{
          RowBox[{
          "pos", "\[LeftDoubleBracket]", "SIDE", "\[RightDoubleBracket]"}], 
          ",", "1"}], "]"}], "=!=", "0"}], ",", "\[IndentingNewLine]", 
       RowBox[{"BlackSearchPosition", "[", 
        RowBox[{
        "pos", ",", "\[Alpha]", ",", "\[Beta]", ",", "depth", ",", 
         "maxdepth"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"WhiteSearchPosition", "[", 
        RowBox[{
        "pos", ",", "\[Alpha]", ",", "\[Beta]", ",", "depth", ",", 
         "maxdepth"}], "]"}]}], "]"}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"WhiteSearchPosition", "[", 
     RowBox[{
     "pos_", ",", "\[Alpha]\[Alpha]_", ",", "\[Beta]\[Beta]_", ",", "depth_", 
      ",", "maxdepth_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MoveList", "=", 
         RowBox[{"WhitePseudoLegalMoves", "[", "pos", "]"}]}], ",", "x", ",", 
        RowBox[{"\[Alpha]", "=", "\[Alpha]\[Alpha]"}], ",", 
        RowBox[{"\[Beta]", "=", "\[Beta]\[Beta]"}], ",", 
        RowBox[{"MateQ", "=", "True"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nodes", "++"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MoveList", "===", "0"}], ",", 
         RowBox[{"Return", "[", "\"\<illegal\>\"", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"depth", "\[GreaterEqual]", "maxdepth"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"EvaluatePosition", "[", "pos", "]"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"x", "=", 
           RowBox[{"BlackSearchPosition", "[", 
            RowBox[{
             RowBox[{"WhiteMakePseudoLegalMove", "[", 
              RowBox[{"pos", ",", "Move"}], "]"}], ",", "\[Alpha]", ",", 
             "\[Beta]", ",", 
             RowBox[{"depth", "+", "1"}], ",", "maxdepth"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"x", "=!=", "\"\<illegal\>\""}], ",", 
            RowBox[{
             RowBox[{"MateQ", "=", "False"}], ";", 
             RowBox[{"\[Alpha]", "=", 
              RowBox[{"Max", "[", 
               RowBox[{"\[Alpha]", ",", "x"}], "]"}]}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"\[Alpha]", "\[GreaterEqual]", "\[Beta]"}], ",", 
               RowBox[{"Return", "[", "\[Alpha]", "]"}]}], "]"}]}]}], "]"}]}],
          "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"Move", ",", "MoveList"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"MateQ", ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BitAnd", "[", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "WKING", 
               "\[RightDoubleBracket]"}], ",", 
              RowBox[{"BlackCoverage", "[", "pos", "]"}]}], "]"}], "=!=", 
            "0"}], ",", 
           RowBox[{"Return", "[", 
            RowBox[{
             RowBox[{"-", "MATESCORE"}], "+", "depth"}], "]"}], ",", 
           RowBox[{"Return", "[", "0", "]"}]}], "]"}], ",", 
         RowBox[{"Return", "[", "\[Alpha]", "]"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlackSearchPosition", "[", 
    RowBox[{
    "pos_", ",", "\[Alpha]\[Alpha]_", ",", "\[Beta]\[Beta]_", ",", "depth_", 
     ",", "maxdepth_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MoveList", "=", 
        RowBox[{"BlackPseudoLegalMoves", "[", "pos", "]"}]}], ",", "x", ",", 
       RowBox[{"\[Alpha]", "=", "\[Alpha]\[Alpha]"}], ",", 
       RowBox[{"\[Beta]", "=", "\[Beta]\[Beta]"}], ",", 
       RowBox[{"MateQ", "=", "True"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nodes", "++"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MoveList", "===", "0"}], ",", 
        RowBox[{"Return", "[", "\"\<illegal\>\"", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"depth", "\[GreaterEqual]", "maxdepth"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"EvaluatePosition", "[", "pos", "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"x", "=", 
          RowBox[{"WhiteSearchPosition", "[", 
           RowBox[{
            RowBox[{"BlackMakePseudoLegalMove", "[", 
             RowBox[{"pos", ",", "Move"}], "]"}], ",", "\[Alpha]", ",", 
            "\[Beta]", ",", 
            RowBox[{"depth", "+", "1"}], ",", "maxdepth"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"x", "=!=", "\"\<illegal\>\""}], ",", 
           RowBox[{
            RowBox[{"MateQ", "=", "False"}], ";", 
            RowBox[{"\[Beta]", "=", 
             RowBox[{"Min", "[", 
              RowBox[{"\[Beta]", ",", "x"}], "]"}]}], ";", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"\[Beta]", "\[LessEqual]", "\[Alpha]"}], ",", 
              RowBox[{"Return", "[", "\[Beta]", "]"}]}], "]"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"Move", ",", "MoveList"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"MateQ", ",", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"BitAnd", "[", 
            RowBox[{
             RowBox[{
             "pos", "\[LeftDoubleBracket]", "BKING", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{"WhiteCoverage", "[", "pos", "]"}]}], "]"}], "=!=", 
           "0"}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{"+", "MATESCORE"}], "-", "depth"}], "]"}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ",", 
        RowBox[{"Return", "[", "\[Beta]", "]"}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdy2kogwEAxvEXs6KMiVzlKDI5FsrKkbl9kCtJSK7JkSTHZsoxGSKJQnxD
cpTmNsfKsTVEDY3I+MDkaM01S8T7vB+efj0f/h6FVek8U4IgPMlBAUswSNw/
Rbntng9BzSJ9Cw5LGJSP35cBJqTf7Gw2FD95z0HimS+BXnJ/hinpReWuIxS0
nnhAsV0+G4ZzSyPhuHiJC9N+pXlQr2zjwewSAZ/6NyVCGCKzbYe6UQ5l77tL
N5R18Feg+rJSBjNlkhMY2CS+gE7H67eQFfP8ACXGeB1UZBSYmJHezjcw4bHI
0AObaV998GB9uYZGKrpW1EKtUNUBy3fKumCWdc02/PCJk0N5r9UpLOTcnMHc
xGsNTN4w6GGa8coAiZnNH9jIiWWYkyojLJlQ2z/mDNUxIhZ8m70LhtEaIQdO
+CVEQlZdC6U+S5UAf6pfKfsq9pNgT61DMoyaHKijem/XeqjSuk/BRO7wNFzY
s1mF/HkLKcyZ+lPAoqAUJSwO+z2i+qRUNVzivdjTSTtpn47QeLjmBqOZUncY
OmLhC+kLukD4D3ivLNs=
  "]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["test", "Title",
 CellChangeTimes->{{3.6095207481051626`*^9, 3.609520749520243*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"currpos", "=", 
   RowBox[{"BoardMatrixToPosition", "[", 
    RowBox[{
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {"\"\<r\>\"", "\"\<n\>\"", "\"\<b\>\"", "\"\<q\>\"", "\"\<k\>\"", 
         "\"\<b\>\"", "\"\<n\>\"", "\"\<r\>\""},
        {"\"\<p\>\"", "\"\<p\>\"", "\"\<p\>\"", "\"\<p\>\"", "\"\<p\>\"", 
         "\"\<p\>\"", "\"\<p\>\"", "\"\<p\>\""},
        {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
         "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
        {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
         "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
        {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
         "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
        {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
         "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
        {"\"\<P\>\"", "\"\<P\>\"", "\"\<P\>\"", "\"\<P\>\"", "\"\<P\>\"", 
         "\"\<P\>\"", "\"\<P\>\"", "\"\<P\>\""},
        {"\"\<R\>\"", "\"\<N\>\"", "\"\<B\>\"", "\"\<Q\>\"", "\"\<K\>\"", 
         "\"\<B\>\"", "\"\<N\>\"", "\"\<R\>\""}
       }], "\[NoBreak]", ")"}], ",", "15", ",", "64", ",", "0"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"currpos", "=", 
  RowBox[{"BoardMatrixToPosition", "[", 
   RowBox[{
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
        "\"\<K\>\"", "\"\< \>\"", "\"\< \>\""},
       {"\"\<r\>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
        "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
       {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\<k\>\"", 
        "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
       {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
        "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
       {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
        "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
       {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
        "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
       {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
        "\"\< \>\"", "\"\< \>\"", "\"\< \>\""},
       {"\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", "\"\< \>\"", 
        "\"\< \>\"", "\"\< \>\"", "\"\< \>\""}
      }], "\[NoBreak]", ")"}], ",", "0", ",", "64", ",", "1"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.609677632808853*^9, 3.6096777325035553`*^9}, {
   3.6096837892593603`*^9, 3.6096837928205643`*^9}, {3.609685430275221*^9, 
   3.6096854550446377`*^9}, 3.609685489672619*^9, {3.6096856059732704`*^9, 
   3.6096856074723563`*^9}, {3.6096867397781205`*^9, 3.609686744121369*^9}, {
   3.6096878456343718`*^9, 3.6096878458683853`*^9}, {3.609688113839712*^9, 
   3.6096881288115687`*^9}, {3.609694135634139*^9, 3.609694138409298*^9}, {
   3.6096941712451763`*^9, 3.6096941715001907`*^9}, {3.6096943243689346`*^9, 
   3.6096943248959646`*^9}, {3.6096944108358803`*^9, 
   3.6096944149031124`*^9}, {3.609706834927497*^9, 3.5843998519341516`*^9}, {
   3.6097180178504066`*^9, 3.6097180179454126`*^9}, {3.6097198711424093`*^9, 
   3.609719872293475*^9}, {3.6097218353157535`*^9, 3.6097218384869347`*^9}, {
   3.609723401594923*^9, 3.6097234229591446`*^9}, {3.6097261167806835`*^9, 
   3.609726120644904*^9}, {3.609726165696481*^9, 3.6097261854566116`*^9}, {
   3.6097292681589317`*^9, 3.6097292713901167`*^9}, {3.609729355203911*^9, 
   3.6097293991934266`*^9}, {3.6097295145280237`*^9, 3.609729520435361*^9}, {
   3.6097295995868883`*^9, 3.609729609795472*^9}, {3.609729641135265*^9, 
   3.6097296532029552`*^9}, {3.609729860304801*^9, 3.609729899792059*^9}, {
   3.609730336877059*^9, 3.60973034143532*^9}, {3.6097303839967537`*^9, 
   3.609730388418007*^9}, {3.60973194485203*^9, 3.609731949698307*^9}, {
   3.609732209583172*^9, 3.6097322097441807`*^9}, {3.609732330498088*^9, 
   3.609732342024747*^9}, {3.609733647539418*^9, 3.6097336593940964`*^9}, {
   3.6097345143099947`*^9, 3.6097345328750563`*^9}, {3.609735009869339*^9, 
   3.609735023893141*^9}, {3.6097350588381395`*^9, 3.60973511111413*^9}, {
   3.6097351915877323`*^9, 3.6097351958849783`*^9}, {3.609735610601699*^9, 
   3.6097356109687195`*^9}, {3.609735728760457*^9, 3.6097357289604683`*^9}, {
   3.6097357904949884`*^9, 3.609735790704*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "32", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "32", ",", "0",
    ",", "1048832", ",", "0", ",", "0", ",", "0", ",", "256", ",", "0", ",", 
   "1048576", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", "0"}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.6096777778571496`*^9, 3.6096793696558743`*^9, 3.6096837934095984`*^9, {
   3.609685299362734*^9, 3.6096853136615515`*^9}, 3.609685362469343*^9, 
   3.609685400436515*^9, {3.609685444359027*^9, 3.609685512672934*^9}, 
   3.609685608149395*^9, 3.609685853485428*^9, 3.6096859696150694`*^9, 
   3.6096862342022033`*^9, 3.6096863729541397`*^9, 3.609686744592396*^9, 
   3.6096878463054104`*^9, 3.60968812970662*^9, 3.6096941080175595`*^9, 
   3.609694139644369*^9, 3.6096941721952305`*^9, {3.6096943042067814`*^9, 
   3.609694325475998*^9}, 3.6096944155141478`*^9, {3.6097068301422234`*^9, 
   3.5843998528122015`*^9}, {3.609717997885265*^9, 3.609718018513445*^9}, 
   3.6097182480175714`*^9, 3.6097183367636476`*^9, 3.609718384496378*^9, 
   3.6097185279665837`*^9, 3.609719873323534*^9, 3.609720447152355*^9, 
   3.609720726047307*^9, 3.6097208643912196`*^9, {3.6097209287349*^9, 
   3.6097209768076496`*^9}, 3.609721128887348*^9, 3.6097212285520487`*^9, 
   3.6097213450287104`*^9, 3.60972150465184*^9, {3.6097218150175924`*^9, 
   3.6097218387529497`*^9}, 3.60972315940207*^9, 3.60972333720524*^9, {
   3.6097234035360336`*^9, 3.6097234234631734`*^9}, {3.609726100778768*^9, 
   3.6097261209069195`*^9}, {3.6097261665365295`*^9, 3.6097262038656645`*^9}, 
   3.6097263912743835`*^9, 3.609728960228319*^9, {3.609729248254793*^9, 
   3.609729272286168*^9}, 3.609729405529789*^9, 3.6097295208583856`*^9, 
   3.6097295584845376`*^9, 3.609729610349504*^9, {3.6097296416882963`*^9, 
   3.609729654211013*^9}, {3.6097298662101383`*^9, 3.6097299005981054`*^9}, {
   3.609730111477167*^9, 3.609730127843103*^9}, 3.6097301901086645`*^9, 
   3.6097303422253647`*^9, 3.609730389199052*^9, 3.609730480499274*^9, 
   3.6097313583774853`*^9, 3.609731436451951*^9, 3.609731518380637*^9, 
   3.6097316627548947`*^9, 3.609731803652954*^9, {3.6097319330473547`*^9, 
   3.609731950935378*^9}, 3.6097321072683196`*^9, 3.609732179462449*^9, 
   3.609732210516225*^9, {3.6097323336052656`*^9, 3.609732342373767*^9}, {
   3.609733640034989*^9, 3.609733660193142*^9}, 3.6097337130751667`*^9, 
   3.6097337600028505`*^9, {3.6097344958829403`*^9, 3.6097345364112587`*^9}, {
   3.6097346455875034`*^9, 3.6097346606873665`*^9}, 3.609734841365701*^9, {
   3.6097350120334625`*^9, 3.609735024314165*^9}, {3.609735060814253*^9, 
   3.609735113233251*^9}, 3.60973519644001*^9, 3.609735377263353*^9, 
   3.609735450364534*^9, 3.60973561167776*^9, 3.609735729643508*^9, 
   3.6097357947482314`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"nodes", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"SearchPosition", "[", 
  RowBox[{"currpos", ",", 
   RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]", ",", "0", ",", "8"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.6097294642091455`*^9, 3.609729501333269*^9}, {
  3.6097302021843553`*^9, 3.6097302023523645`*^9}, {3.6097322193377295`*^9, 
  3.6097322196657486`*^9}, {3.6097350650534954`*^9, 3.6097350744700336`*^9}, {
  3.609735132109331*^9, 3.609735141332858*^9}, {3.6097352019333243`*^9, 
  3.6097352025243583`*^9}, {3.6097354969151964`*^9, 3.609735499654353*^9}, {
  3.6097357267363415`*^9, 3.6097357269453535`*^9}, {3.6097357580681334`*^9, 
  3.609735758309147*^9}, {3.6097357934531574`*^9, 3.6097357936521688`*^9}}],

Cell[BoxData[
 RowBox[{"-", "999993"}]], "Output",
 CellChangeTimes->{{3.609729467418329*^9, 3.6097295062225485`*^9}, 
   3.6097296586732683`*^9, 3.6097301346284914`*^9, {3.6097301916447525`*^9, 
   3.6097302027063847`*^9}, {3.609731935685506*^9, 3.6097319627950563`*^9}, 
   3.609732121716146*^9, {3.6097321966204305`*^9, 3.6097322203637886`*^9}, {
   3.6097323350373473`*^9, 3.609732344802906*^9}, {3.609733643466185*^9, 
   3.609733664639396*^9}, 3.6097337198905563`*^9, 3.6097337789649353`*^9, {
   3.609734500629212*^9, 3.609734537546324*^9}, {3.6097346475916176`*^9, 
   3.609734664552588*^9}, 3.6097348547864685`*^9, 3.6097350143335943`*^9, {
   3.6097350464694324`*^9, 3.609735142548928*^9}, {3.6097351984091225`*^9, 
   3.6097352254036665`*^9}, 3.6097354363067293`*^9, 3.6097354749059377`*^9, 
   3.6097356056904182`*^9, {3.6097357194529247`*^9, 3.609735738968041*^9}, 
   3.6097357845046453`*^9, 3.609736040050262*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dynamic", "[", "nodes", "]"}]], "Input",
 CellChangeTimes->{{3.609735576648757*^9, 3.6097355792379045`*^9}}],

Cell[BoxData[
 DynamicBox[ToBoxes[$CellContext`nodes, StandardForm],
  ImageSizeCache->{63., {0., 11.}}]], "Output",
 CellChangeTimes->{3.6097355797839365`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"EvaluatePosition", "[", "currpos", "]"}]], "Input",
 CellChangeTimes->{{3.6097261021268454`*^9, 3.609726108644218*^9}}],

Cell[BoxData["1152"], "Output",
 CellChangeTimes->{{3.6097261092652535`*^9, 3.609726122129989*^9}, {
   3.6097261778581767`*^9, 3.6097262053337483`*^9}, {3.609726392424449*^9, 
   3.6097263983987913`*^9}, 3.6097294371865997`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"PseudoLegalMoves", "[", "currpos", "]"}]], "Input",
 CellChangeTimes->{{3.6097303480897007`*^9, 3.609730353253996*^9}}],

Cell[BoxData["4096"], "Print",
 CellChangeTimes->{3.609730353696021*^9}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{3.609730353698021*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MakePseudoLegalMove", "[", 
  RowBox[{"currpos", ",", 
   RowBox[{
    RowBox[{"PseudoLegalMoves", "[", "currpos", "]"}], "[", 
    RowBox[{"[", "4", "]"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6097315660263624`*^9, 3.6097315821142826`*^9}, {
  3.6097319024116025`*^9, 3.609731903555668*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "4096", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "4096", ",", 
   "0", ",", "1048576", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",",
    "1048576", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", "0"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.609731904875744*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Table", "[", 
  RowBox[{
   RowBox[{"MakePseudoLegalMove", "[", 
    RowBox[{"currpos", ",", "move"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"move", ",", 
     RowBox[{"PseudoLegalMoves", "[", "currpos", "]"}]}], "}"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.609729684391739*^9, 3.6097297065400057`*^9}, {
  3.609729757423916*^9, 3.609729772910802*^9}, {3.609729805990694*^9, 
  3.609729810686963*^9}, {3.609729927334635*^9, 3.609729973161256*^9}, {
  3.6097302244846306`*^9, 3.6097302444317713`*^9}, {3.609730368766883*^9, 
  3.6097303998186593`*^9}}],

Cell[BoxData["\<\"generating white moves\"\>"], "Print",
 CellChangeTimes->{3.609730483421441*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "8", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ",", "0",
      ",", "1052672", ",", "0", ",", "0", ",", "0", ",", "0", ",", "4096", 
     ",", "1048576", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", 
     "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "32", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "32", ",", 
     "0", ",", "1052672", ",", "0", ",", "0", ",", "0", ",", "0", ",", "4096",
      ",", "1048576", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", 
     "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2048", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "2048", 
     ",", "0", ",", "1052672", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     "4096", ",", "1048576", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0",
      ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "4096", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "4096", 
     ",", "0", ",", "1052672", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     "0", ",", "1048576", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", 
     ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "8192", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8192", 
     ",", "0", ",", "1052672", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     "4096", ",", "1048576", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0",
      ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6097296809915447`*^9, {3.6097297670454664`*^9, 3.609729775531952*^9}, 
   3.6097298111509895`*^9, {3.609729891375578*^9, 3.609729904505329*^9}, {
   3.609729958325407*^9, 3.609729973726288*^9}, 3.609730114981367*^9, {
   3.6097302106538396`*^9, 3.60973024562784*^9}, {3.609730376970352*^9, 
   3.6097304007407117`*^9}, 3.609730483423441*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"PseudoLegalMoves", "[", "%", "]"}]], "Input",
 CellChangeTimes->{{3.6097304149825263`*^9, 3.609730426598191*^9}, 
   3.6097319244078608`*^9}],

Cell[BoxData["4096"], "Print",
 CellChangeTimes->{3.6097304273812356`*^9, 3.609730496614196*^9, 
  3.6097305469100723`*^9, 3.6097307237011843`*^9, 3.6097307852157025`*^9, 
  3.609730886324486*^9, 3.6097318361828146`*^9, 3.609731924785882*^9}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{3.609730427383236*^9, 3.609730496621196*^9, 
  3.6097305469150724`*^9, 3.609730723716185*^9, 3.609730785227703*^9, 
  3.6097308863364863`*^9, 3.6097318362028155`*^9, 3.609731924790882*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"PositionToBoardMatrix", "[", 
  RowBox[{"{", 
   RowBox[{
   "4096", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "4096", ",",
     "0", ",", "1052672", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", 
    ",", "1048576", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", 
    "0"}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.6097305178174086`*^9, 3.609730525921872*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   TagBox[GridBox[{
      {"\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \
\"\>", "\<\" \"\>", "\<\" \"\>"},
      {"\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\"K\"\>", "\<\" \
\"\>", "\<\" \"\>", "\<\" \"\>"},
      {"\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\"k\"\>", "\<\" \
\"\>", "\<\" \"\>", "\<\" \"\>"},
      {"\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \
\"\>", "\<\" \"\>", "\<\" \"\>"},
      {"\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \
\"\>", "\<\" \"\>", "\<\" \"\>"},
      {"\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \
\"\>", "\<\" \"\>", "\<\" \"\>"},
      {"\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \
\"\>", "\<\" \"\>", "\<\" \"\>"},
      {"\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \"\>", "\<\" \
\"\>", "\<\" \"\>", "\<\" \"\>"}
     },
     AutoDelete->False,
     GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
    "Grid"], ",", "0", ",", "64", ",", "1"}], "}"}]], "Output",
 CellChangeTimes->{3.6097305262438903`*^9}]
}, Open  ]]
}, Open  ]]
},
ScreenStyleEnvironment->"Condensed",
WindowSize->{1374, 926},
WindowMargins->{{Automatic, -2}, {Automatic, 10}},
ShowSelection->True,
Magnification:>FEPrivate`If[
  FEPrivate`Equal[FEPrivate`$VersionNumber, 6.], 1.5, 1.5 Inherited],
FrontEndVersion->"9.0 for Microsoft Windows (64-bit) (November 20, 2012)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"], Background -> GrayLevel[0]]},
   Visible -> False, FrontEndVersion -> 
  "9.0 for Microsoft Windows (64-bit) (November 20, 2012)", StyleDefinitions -> 
  "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 646, 15, 78, "Input"],
Cell[CellGroupData[{
Cell[1228, 39, 94, 1, 53, "Title"],
Cell[CellGroupData[{
Cell[1347, 44, 111, 1, 55, "Section"],
Cell[1461, 47, 11129, 287, 872, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[12627, 339, 167, 2, 41, "Section"],
Cell[12797, 343, 18977, 507, 1273, "Input"],
Cell[CellGroupData[{
Cell[31799, 854, 104, 1, 46, "Subsection"],
Cell[31906, 857, 6919, 188, 622, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[38862, 1050, 104, 1, 46, "Subsection"],
Cell[38969, 1053, 5958, 159, 472, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44964, 1217, 103, 1, 46, "Subsection"],
Cell[45070, 1220, 431, 12, 72, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[45538, 1237, 102, 1, 46, "Subsection"],
Cell[45643, 1240, 2324, 63, 172, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[48004, 1308, 106, 1, 46, "Subsection"],
Cell[48113, 1311, 2483, 68, 172, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[50633, 1384, 152, 2, 46, "Subsection"],
Cell[50788, 1388, 5792, 161, 547, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[56629, 1555, 101, 1, 41, "Section"],
Cell[56733, 1558, 2134, 51, 572, "Input"],
Cell[58870, 1611, 37706, 874, 3322, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[96613, 2490, 104, 1, 41, "Section"],
Cell[96720, 2493, 5717, 116, 1272, "Input"],
Cell[CellGroupData[{
Cell[102462, 2613, 98, 1, 46, "Subsection"],
Cell[102563, 2616, 9322, 254, 497, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[111922, 2875, 280, 4, 46, "Subsection"],
Cell[112205, 2881, 71032, 1626, 5272, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[183274, 4512, 117, 1, 46, "Subsection"],
Cell[183394, 4515, 35406, 795, 2697, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[218849, 5316, 99, 1, 55, "Section"],
Cell[218951, 5319, 3186, 82, 322, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[222174, 5406, 146, 2, 41, "Section"],
Cell[222323, 5410, 7670, 192, 722, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[230042, 5608, 89, 1, 53, "Title"],
Cell[CellGroupData[{
Cell[230156, 5613, 4353, 71, 390, "Input"],
Cell[234512, 5686, 2780, 41, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[237329, 5732, 770, 13, 72, "Input"],
Cell[238102, 5747, 928, 13, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[239067, 5765, 132, 2, 46, "Input"],
Cell[239202, 5769, 160, 3, 78, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[239399, 5777, 143, 2, 46, "Input"],
Cell[239545, 5781, 229, 3, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[239811, 5789, 143, 2, 46, "Input"],
Cell[239957, 5793, 72, 1, 32, "Print"],
Cell[240032, 5796, 70, 1, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[240139, 5802, 327, 7, 46, "Input"],
Cell[240469, 5811, 337, 7, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[240843, 5823, 585, 13, 46, "Input"],
Cell[241431, 5838, 98, 1, 32, "Print"],
Cell[241532, 5841, 1871, 38, 147, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[243440, 5884, 165, 3, 46, "Input"],
Cell[243608, 5889, 242, 3, 32, "Print"],
Cell[243853, 5894, 236, 3, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[244126, 5902, 416, 8, 46, "Input"],
Cell[244545, 5912, 1188, 24, 189, "Output"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
